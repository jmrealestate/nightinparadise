import{a as $,b as V}from"./chunk-4T2Q2FHT.js";import{a as d,b as L,c as z}from"./chunk-PRWEWJF3.js";import{a as I,b as j}from"./chunk-GXCC2ORA.js";import"./chunk-QHM7Z56U.js";import{a,b as Y}from"./chunk-AXDSQ2ON.js";import{c as T,d as X}from"./chunk-VAAUDI2H.js";import"./chunk-UOQFKZ5Q.js";import{a as N,b as U}from"./chunk-I6XSNUQR.js";import{a as B,b as K}from"./chunk-DKBVEZ2J.js";import{Qa as P,Ra as F,Sa as O,ma as k,oa as H,ya as M}from"./chunk-P2MZAAVA.js";import{$b as C,Ab as g,Fb as p,Ga as u,Lb as y,M as c,Qb as S,Rb as b,Sb as v,Vc as A,Zb as E,a as r,b as h,ba as G,e as q,ib as f,la as o,n as m,pa as x,sc as D,tb as _,uc as w}from"./chunk-LUSYJMV7.js";function J(n,s){if(n&1&&v(0,"ks-basic-grid",1),n&2){let l=C();p("config",l.gridConfig)("refresh$",l.refresh$)}}var W,xe,Q=q(()=>{A();H();O();G();K();j();U();X();V();Y();z();A();W=n=>({date:n,format:"MMMM yyyy"});xe=(()=>{let s=class s{constructor(){this._destroyRef=o(u),this._dialog=o(M),this._navService=o(N),this._configService=o(I),this._sessionService=o(T),this._expensesService=o($),this.date=this._expensesService.date,this.refresh$=new m,this._isAdmin=this._sessionService.checkAccess(a.ADMIN),this._canAdd=this._sessionService.checkAccess(a.ADD_EXPENSE),this._canEdit=this._sessionService.checkAccess(a.EDIT_EXPENSE),this._canDelete=this._sessionService.checkAccess(a.DELETE_EXPENSE)}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:B.LAYOUT.children.EXPENSES.name,buttons:[{label:{text:"Change Month"},prefixIcon:{icon:"icon_calendar"},onClick:()=>this._openSearchByDate()},{label:{text:"Add Expense"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._canAdd,onClick:()=>this._openExpensePopup()}]}),this._expensesService.date.set(new Date),this._initializeGrid(),this._expensesService.getExpenses()}ngAfterViewInit(){this._expensesService.filteredExpenses$.pipe(k(this._destroyRef)).subscribe(e=>{this.refresh$.next({data:e})})}changeDate(e){this._expensesService.changeDate(e)}_openSearchByDate(){let e={hideClearButton:!0,title:{text:"Change Month"},saveButton:{label:{text:"Search"},prefixIcon:{icon:"icon_search"},matType:"mat-stroked-button"},form:{value:{month:new Date().getMonth()+1,year:new Date().getFullYear()},fields:[{name:"month",label:{text:"Month"},type:"select",required:!0,options:L},{name:"year",label:{text:"Year"},type:"text",required:!0,onlyNumeric:!0,maxLength:4,minLength:4}]}};this._dialog.openFormPopup(e,"400px").afterClosed().pipe(c(1)).subscribe(t=>{t&&this._expensesService.changeDate(t)})}_initializeGrid(){this.gridConfig={data:_([]),defaultPagination:100,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,noDataMessage:{text:"No Expenses Found"},features:{showSearch:!0},columns:[{field:"name",title:"Expense",type:"string",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"}},{field:"amount",title:"Amount",type:"number",extraStyles:{"min-width":"100px","max-width":"100px",width:"100px"}},{field:"notes",title:"Notes",type:"string",extraStyles:{"max-width":"300px","min-width":"150px"}},{field:"date",title:"Date",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"110px","max-width":"110px",width:"110px"}},{field:"createdBy",title:"Created By",type:"string",extraStyles:{"min-width":"120px","max-width":"120px",width:"120px"},hide:!this._isAdmin},{field:"createdAt",title:"Created At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"},hide:!this._isAdmin}],actionsColumn:h(r({},this._configService.getActionColumn(2)),{enabled:this._canEdit||this._canDelete,buttons:[{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:e=>this._openExpensePopup(e),matType:"mat-icon-button",isVisibleFn:()=>this._canEdit},{prefixIcon:{icon:"icon_delete"},color:"warn",label:{text:"Delete"},onClickFn:e=>this._deleteExpense(e),matType:"mat-icon-button",isVisibleFn:()=>this._canDelete}]})}}_openExpensePopup(e){let t={hideClearButton:!0,title:{text:e?"Edit Expense":"Add Expense"},form:{value:e||{date:d()},fields:[{name:"name",maxLength:30,required:!0,flexibleValue:!0,type:"autocomplete",label:{text:"Expense"},stream:this._expensesService.expensesLov$,transformer:{nameKey:"name",valueKey:"value"}},{name:"amount",type:"number",label:{text:"Amount in $"},required:!0,range:{max:1e5}},{name:"date",type:"date",label:{text:"Date"},required:!0},{name:"notes",type:"text",label:{text:"Notes"},maxLength:100}]},beforeCloseObservable:i=>(i.date=d(i.date),e?this._expensesService.updateExpense(r(r({},e),i)):this._expensesService.addExpense(i)),getAfterSuccessResponse:i=>{i.data&&this._expensesService._updateStream(i.data,e?"edit":"add")}};this._dialog.openFormPopup(t,"500px")}_deleteExpense(e){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this expense?"}}).afterClosed().pipe(c(1)).subscribe(t=>{t&&e?._id&&this._expensesService.deleteExpense(e)})}};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=x({type:s,selectors:[["ks-solutions-expenses"]],standalone:!0,features:[D],decls:2,vars:4,consts:[[3,"btnClicked","config"],[3,"config","refresh$"]],template:function(t,i){t&1&&(S(0,"ks-base-changer",0),E("btnClicked",function(R){return i.changeDate(R)}),b(),g(1,J,1,2,"ks-basic-grid",1)),t&2&&(p("config",w(2,W,i.date)),f(),y(i.gridConfig?1:-1))},dependencies:[P,F],changeDetection:0});let n=s;return n})()});Q();export{xe as ExpensesComponent};
