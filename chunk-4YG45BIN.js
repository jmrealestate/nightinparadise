import{b as Q,c as se}from"./chunk-PRWEWJF3.js";import{a as W,b as re}from"./chunk-H62IVGHA.js";import{a as J,b as oe}from"./chunk-QHM7Z56U.js";import{a as l,b as ie}from"./chunk-AXDSQ2ON.js";import{c as z,d as ee}from"./chunk-VAAUDI2H.js";import{a as p,b as ne}from"./chunk-UOQFKZ5Q.js";import{a as q,b as Z}from"./chunk-I6XSNUQR.js";import{a as K,b as te}from"./chunk-DKBVEZ2J.js";import{Ba as H,Qa as O,Ra as Y,Sa as G,ma as U,na as j,oa as L,ya as V}from"./chunk-P2MZAAVA.js";import{$b as B,Ab as E,Fb as h,Ga as R,Lb as M,M as s,Qb as A,Rb as F,Sb as N,Vc as c,Zb as $,a as g,b as v,ba as w,e as x,fa as C,ib as k,la as o,n as y,o as _,pa as D,rc as I,sc as P,tb as a,uc as T,y as S,z as b}from"./chunk-LUSYJMV7.js";var m,X=x(()=>{"use strict";c();L();G();w();ne();oe();c();m=(()=>{let i=class i{constructor(){this._networkService=o(H),this._revenues$=new _([]),this.date=a(new Date),this.filteredRevenues$=b([this._revenues$,j(this.date)]).pipe(S(([e,t])=>{let r=(t.getMonth()+1).toString().padStart(2,"0"),f=t.getFullYear();return e.filter(d=>d.date.startsWith(`${f}-${r}`))}))}changeDate(e){this.date.update(t=>{if(typeof e=="string"){let r=new Date(t);return r.setDate(15),e==="next"?r.setMonth(t.getMonth()+1):r.setMonth(t.getMonth()-1),r}else return new Date(e.year,e.month-1,15)})}getRevenues(){this._networkService.get(p.REVENUES).pipe(s(1)).subscribe({next:e=>{e.data&&this._revenues$.next(e.data)}})}deleteRevenue(e){this._networkService.delete(p.REVENUES,void 0,e._id).pipe(s(1)).subscribe(()=>{J.UpdateArrayBehaviorSubject(this._revenues$,e,"delete","_id")})}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=C({token:i,factory:i.\u0275fac});let n=i;return n})()});function de(n,i){if(n&1&&N(0,"ks-basic-grid",1),n&2){let u=B();h("config",u.gridConfig)("refresh$",u.refresh$)}}var ce,Ne,he=x(()=>{c();L();G();w();X();te();re();Z();ee();ie();se();c();ce=n=>({date:n,format:"MMMM yyyy"});Ne=(()=>{let i=class i{constructor(){this._destroyRef=o(R),this._dialog=o(V),this._navService=o(q),this._configService=o(W),this._sessionService=o(z),this._revenuesService=o(m),this.date=this._revenuesService.date,this.refresh$=new y,this._isAdmin=this._sessionService.checkAccess(l.ADMIN),this._canDelete=this._sessionService.checkAccess(l.DELETE_REVENUE)}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:K.LAYOUT.children.REVENUES.name,buttons:[{label:{text:"Change Month"},prefixIcon:{icon:"icon_calendar"},onClick:()=>this._openSearchByDate()}]}),this._initializeGrid(),this._revenuesService.getRevenues()}ngAfterViewInit(){this._revenuesService.filteredRevenues$.pipe(U(this._destroyRef)).subscribe(e=>{this.refresh$.next({data:e})})}changeDate(e){this._revenuesService.changeDate(e)}_openSearchByDate(){let e={hideClearButton:!0,title:{text:"Change Month"},saveButton:{label:{text:"Search"},prefixIcon:{icon:"icon_search"},matType:"mat-stroked-button"},form:{value:{month:new Date().getMonth()+1,year:new Date().getFullYear()},fields:[{name:"month",label:{text:"Month"},type:"select",required:!0,options:Q},{name:"year",label:{text:"Year"},type:"text",required:!0,onlyNumeric:!0,maxLength:4,minLength:4}]}};this._dialog.openFormPopup(e,"400px").afterClosed().pipe(s(1)).subscribe(t=>{t&&this._revenuesService.changeDate(t)})}_initializeGrid(){this.gridConfig={data:a([]),defaultPagination:100,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,noDataMessage:{text:"No Payments Found"},features:{showSearch:!0},columns:[{field:"customerName",title:"Payment",type:"string",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"}},{field:"amount",title:"Amount",type:"number",extraStyles:{"min-width":"100px","max-width":"100px",width:"100px"}},{field:"deletedReservation",title:"Reservation",type:"chip",extraStyles:{"max-width":"120px",width:"120px"},truthy:{false:"",true:"Canceled"},setChipClass:e=>e.deletedReservation===!0?"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120":""},{field:"notes",title:"Notes",type:"string",extraStyles:{"max-width":"300px","min-width":"150px"}},{field:"date",title:"Date",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"110px","max-width":"110px",width:"110px"}},{field:"createdBy",title:"Created By",type:"string",extraStyles:{"min-width":"120px","max-width":"120px",width:"120px"},hide:!this._isAdmin},{field:"createdAt",title:"Created At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"},hide:!this._isAdmin}],actionsColumn:v(g({},this._configService.getActionColumn(1)),{enabled:this._canDelete,buttons:[{prefixIcon:{icon:"icon_delete"},color:"warn",label:{text:"Delete"},onClickFn:e=>this._deleteRevenue(e),matType:"mat-icon-button",isVisibleFn:()=>this._canDelete}]})}}_deleteRevenue(e){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this payment?"}}).afterClosed().pipe(s(1)).subscribe(t=>{t&&e?._id&&this._revenuesService.deleteRevenue(e)})}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=D({type:i,selectors:[["ks-solutions-revenues"]],standalone:!0,features:[I([m]),P],decls:2,vars:4,consts:[[3,"btnClicked","config"],[3,"config","refresh$"]],template:function(t,r){t&1&&(A(0,"ks-base-changer",0),$("btnClicked",function(d){return r.changeDate(d)}),F(),E(1,de,1,2,"ks-basic-grid",1)),t&2&&(h("config",T(2,ce,r.date)),k(),M(r.gridConfig?1:-1))},dependencies:[O,Y],changeDetection:0});let n=i;return n})()});he();export{Ne as RevenuesComponent};
