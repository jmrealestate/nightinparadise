import{a as n,b as j,c as H,d as K,e as b,f as ae}from"./chunk-DGC345CB.js";import{a as O,b as ne}from"./chunk-PBZLLU35.js";import{c as L,d as te}from"./chunk-ICNAXN57.js";import{a as N,b as re}from"./chunk-TS6MWPKE.js";import"./chunk-2JAAJZAJ.js";import{a as M,b as ee}from"./chunk-CCRCP4DV.js";import{a as I,b as ie}from"./chunk-APVBAPPR.js";import{Ca as P,Ha as D,La as G,Ua as U,Wa as Z,ma as F,oa as X}from"./chunk-HBX2KYD3.js";import{$b as y,Ab as v,Bc as w,Cc as E,Fb as p,Ga as k,Lb as g,M as f,Qb as h,Rb as m,Sb as d,Vc as B,ba as J,dd as $,e as z,ib as s,la as a,md as Q,n as _,pa as S,rc as R,sc as T,tb as x,tc as Y,u as C,uc as A,v as u}from"./chunk-J2DESNEB.js";function le(i,o){if(i&1&&d(0,"ks-basic-grid",4),i&2){let c=y();p("config",c.summaryGridConfig)("refresh$",c.summaryGridRefresh)}}function pe(i,o){if(i&1&&(h(0,"div",5),d(1,"div",6)(2,"div",6)(3,"div",6)(4,"div",6),m()),i&2){let c=y();s(),p("chart",c.pnlChart),s(),p("chart",c.revenueChart),s(),p("chart",c.expenseChart),s(),p("chart",c.reservationChart)}}var se,oe,Ae,ce=z(()=>{Q();B();X();K();Z();J();ie();re();ee();te();ae();ne();B();K();se=i=>({text:i,tag:"h3"}),oe=()=>({text:"Summary",tag:"h4"});Ae=(()=>{let o=class o{constructor(){this._destroyRef=a(k),this._dialog=a(P),this._navService=a(M),this._excelService=a(b),this._snackbar=a(D),this._configService=a(N),this._reportsService=a(O),this._sessionService=a(L),this._user=this._sessionService.loggedInUser,this.selectedYears=x([new Date().getFullYear()-1,new Date().getFullYear()]),this.benchmark$=this._reportsService.benchmark$,this.pnlChart=new n,this.revenueChart=new n,this.expenseChart=new n,this.reservationChart=new n,this.unpaidChart=new n,this.summaryGridRefresh=new _}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:I.LAYOUT.children.REPORTS.children.BENCHMARK.name,buttons:[{label:{text:"Change Years"},prefixIcon:{icon:"icon_calendar"},onClick:()=>this._changeYears()},{label:{text:"Download Excel"},prefixIcon:{icon:"icon_excel"},onClick:()=>this._saveExcel(),hide:!this._user?.admin}]}),this._initGrid()}ngAfterViewInit(){this._getBenchmark(),this.benchmark$.pipe(F(this._destroyRef)).subscribe(t=>{t&&this._reflectBenchmark(t)})}_changeYears(){let t={title:{text:"Change Years"},form:{fields:[{label:{text:"From Year"},required:!0,name:"from",type:"number",integer:!0,disableNegativeValues:!0,range:{max:"to"}},{label:{text:"To Year"},required:!0,name:"to",type:"number",integer:!0,disableNegativeValues:!0,range:{min:"from"}}]},beforeCloseObservable:e=>e.from&&e.to&&Math.abs(e.from-e.to)>4?(this._snackbar.open({text:"Maximum allowed year gap is 5 year."},"error"),u(()=>"")):e.from!==void 0&&e.to!==void 0&&e.from>=e.to?(this._snackbar.open({text:"From year should be smaller than to year."},"error"),u(()=>"")):C(e)};this._dialog.openFormPopup(t,"500px").afterClosed().pipe(f(1)).subscribe(e=>{if(e){let{from:l,to:r}=e,V=r-l,q=Array.from({length:V+1},(me,W)=>l+W);this.selectedYears.set(q),this._getBenchmark()}})}_getBenchmark(){this._reportsService.getBenchmarkReport(this.selectedYears())}_reflectBenchmark(t){let{benchmark:e,summary:l}=t;this.summaryGridRefresh.next({data:e.map(r=>({year:r.year,pnl:r.pnl,revenues:r.totalRevenues,expenses:r.totalExpenses,unpaid:r.totalUnpaidAmount,reservations:r.totalReservations}))}),this._drawCharts(l)}_drawCharts(t){this.pnlChart=new n({chart:{type:"line"},title:{text:"Profit / Loss Trend"},credits:{enabled:!1},xAxis:{categories:t.pnlTrend.map(e=>e.year.toString()),title:{text:"Year"}},yAxis:{title:{text:"PnL ($)"}},series:[{type:"line",data:t.pnlTrend.map(e=>e.pnl),name:"PnL"}]}),this.revenueChart=new n({chart:{type:"column"},title:{text:"Total Revenues per Year"},credits:{enabled:!1},xAxis:{categories:t.revenueTrend.map(e=>e.year.toString()),title:{text:"Year"}},yAxis:{title:{text:"Amount ($)"}},series:[{type:"column",data:t.revenueTrend.map(e=>e.totalRevenues),name:"Revenues"}]}),this.expenseChart=new n({chart:{type:"column"},title:{text:"Total Expenses per Year"},credits:{enabled:!1},xAxis:{categories:t.expenseTrend.map(e=>e.year.toString()),title:{text:"Year"}},yAxis:{title:{text:"Amount ($)"}},series:[{type:"column",data:t.expenseTrend.map(e=>e.totalExpenses),name:"Expenses"}]}),this.reservationChart=new n({chart:{type:"column"},title:{text:"Total Reservations per Year"},credits:{enabled:!1},xAxis:{categories:t.reservationsTrend.map(e=>e.year.toString()),title:{text:"Year"}},yAxis:{title:{text:"Count"}},series:[{type:"column",data:t.reservationsTrend.map(e=>e.totalReservations),name:"Reservations"}]}),this.unpaidChart=new n({chart:{type:"line"},title:{text:"Unpaid Amount Trend"},credits:{enabled:!1},xAxis:{categories:t.unpaidTrend.map(e=>e.year.toString()),title:{text:"Year"}},yAxis:{title:{text:"Unpaid ($)"}},series:[{type:"line",data:t.unpaidTrend.map(e=>e.totalUnpaidAmount),name:"Unpaid Amount"}]})}_initGrid(){this.summaryGridConfig={data:x([]),hidePagination:!0,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,columns:[{field:"year",title:"Year",type:"number"},{field:"reservations",title:"Reservations",type:"number"},{field:"revenues",title:"Total Revenues",type:"number",prefix:"$ "},{field:"expenses",title:"Total Expenses",type:"number",prefix:"$ "},{field:"unpaid",title:"Unpaid Amount",type:"number",prefix:"$ "},{field:"pnl",title:"Profit / Loss",type:"number",prefix:"$ "}]}}_saveExcel(){this.benchmark$.pipe(f(1)).subscribe(t=>{t&&this._excelService.createExcelReport({reportTitle:"Benchmark Report",reportTimeFrame:this.selectedYears().join(", "),fields:["Benchmark Summary by Year"],sheets:[{columns:this.summaryGridConfig?.columns||[],data:t.benchmark.map(e=>({year:e.year,pnl:e.pnl,revenues:e.totalRevenues,expenses:e.totalExpenses,unpaid:e.totalUnpaidAmount,reservations:e.totalReservations})),title:"Benchmark Summary"}]},this._user?.name||"")})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=S({type:o,selectors:[["ks-solutions-benchmark-report"]],standalone:!0,features:[R([b]),T],decls:8,vars:9,consts:[[1,"container-fluid","mt-3","text-center"],[3,"config"],[1,"container-fluid"],[1,"mt-4"],[3,"config","refresh$"],[1,"cs-charts","mt-5"],[1,"one","cs-shadow",3,"chart"]],template:function(e,l){if(e&1&&(h(0,"div",0),d(1,"ks-base-label",1),m(),h(2,"div",2)(3,"div",3),d(4,"ks-base-label",1),v(5,le,1,2,"ks-basic-grid",4),m(),v(6,pe,5,4,"div",5),w(7,"async"),m()),e&2){let r;s(),p("config",A(6,se,"Report For "+l.selectedYears().join(" "))),s(3),p("config",Y(8,oe)),s(),g(l.summaryGridConfig?5:-1),s(),g((r=E(7,4,l.benchmark$))?6:-1,r)}},dependencies:[H,j,U,G,$],styles:[".cs-charts[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:20px}"],changeDetection:0});let i=o;return i})()});ce();export{Ae as ReportBenchmarkComponent};
