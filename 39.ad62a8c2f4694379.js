"use strict";(self.webpackChunkpos=self.webpackChunkpos||[]).push([[39],{3039:(Y,p,s)=>{s.r(p),s.d(p,{ExpensesModule:()=>G});var y=s(177),u=s(7062),D=s(4412),d=s(6977),h=s(6697),E=s(1335),C=s(9751),w=s(6994),f=s(2646),b=s(7442),m=s(6933),x=s(8103),M=s(312),W=s(6834),l=s(2288),S=s(5572),i=s(7705),g=s(5351),A=s(1010),N=s(8895),v=s(3524),F=s(6744);const B=function(n){return{date:n,format:"MMMM yyyy"}};var r=function(n){return n.new="Create New",n.search="Search By Date",n.downloadExcel="Download Excel",n}(r||{});const I=[{path:"",component:(()=>{class n extends E.${constructor(t,e,o){super(o),this._dialog=t,this._financeService=e,this._navService=o,this.innerWidth=window.innerWidth,this.isAdmin=(0,m.o)(x.m.admin),this.isEditor=(0,m.o)(x.m.editor),this.columnDefs=this.getCols(),this.defaultColDef={initialWidth:140,sortable:!0,resizable:!0,filter:!0,flex:1,minWidth:140},this.date=new Date,this.expenses$=new D.t([])}ngOnInit(){const t=[{label:r.search,prefixIcon:{icon:"calendar_today"}}];(this.isAdmin||this.isEditor)&&t.push({label:r.new,prefixIcon:{icon:"add_circle"}}),this.isAdmin&&t.unshift({label:r.downloadExcel,prefixIcon:{icon:"library_books"}}),this.Navbar_Update({show:!0,back:!1,title:this.NAV_NAMES.FINANCE.children.EXPENSE.name,buttons:t}),this.NavButtons$.pipe((0,d.Q)(this.__unsubscribe$)).subscribe(e=>{e===r.new?this.openUserPopup():e===r.search?this.openSearch():e===r.downloadExcel&&this.downloadExcel()}),this._financeService.getAllExpenses(),this._financeService.expChanges$.pipe((0,d.Q)(this.__unsubscribe$)).subscribe(e=>{"edit"===e.state?this.openUserPopup(e.exp):"delete"===e.state&&this.onDeleteUser(e.exp)}),this._financeService.expenses$.pipe((0,d.Q)(this.__unsubscribe$)).subscribe(e=>this.getByMonth())}ngOnDestroy(){super.ngOnDestroy(),this._financeService.expChanges$.next({})}onGridReady(t){this.expenses$.pipe((0,d.Q)(this.__unsubscribe$)).subscribe(e=>{e&&(this.rowData=e)})}previousDay(){const t=new Date(this.date);t.setDate(15),t.setMonth(this.date.getMonth()-1),this.date=t,this.getByMonth()}nextDay(){const t=new Date(this.date);t.setDate(15),t.setMonth(this.date.getMonth()+1),this.date=t,this.getByMonth()}downloadExcel(){this._financeService.expenses$.pipe((0,h.s)(1)).subscribe(t=>{this._dialog.open(S.B,{width:"95vw",maxWidth:"300px",maxHeight:"95vh",disableClose:!0,restoreFocus:!1}).afterClosed().pipe((0,h.s)(1)).subscribe(e=>{e&&e.year&&function $(n){if(!n&&!Array.isArray(n))return;const P=(0,W.pA)(new Date).replaceAll(" ","_"),t=[];n.forEach(a=>{t.push({Expense:a.title,Day:(0,f.n)(a.date),Amount:a.price,Notes:a.notes})});const e=l.Wp.json_to_sheet(t);e["!cols"]=[{width:50},{width:20},{width:20},{width:30}];const o=l.Wp.book_new();l.Wp.book_append_sheet(o,e,"Expenses"),(0,l._h)(o,`Expenses_At_${P}.xlsx`)}(t.filter(a=>new Date(a.date).getFullYear()===e.year))})})}getByMonth(){this._financeService.expenses$.pipe((0,h.s)(1)).subscribe(t=>{const e=t.filter(o=>{const a=new Date(o.date),c=a.getMonth(),V=a.getFullYear();return c===this.date.getMonth()&&V===this.date.getFullYear()});this.expenses$.next(e)})}openSearch(){this._dialog.open(b.n,{width:"95vw",maxWidth:"400px",disableClose:!0,restoreFocus:!1,autoFocus:!0}).afterClosed().pipe((0,h.s)(1)).subscribe(t=>{t&&t.date&&(this.date=t.date,this.getByMonth())})}openUserPopup(t){this._dialog.open(M.y,{width:"95vw",maxWidth:"400px",maxHeight:"95vh",disableClose:!0,autoFocus:!t,restoreFocus:!1,data:{title:"Expense",data:t}}).afterClosed().pipe((0,h.s)(1)).subscribe(e=>{e&&t&&this._financeService.editExpense(e),e&&!t&&this._financeService.addNewExpense(e)})}onDeleteUser(t){this._dialog.open(C.r,{width:"95vw",maxWidth:"500px",disableClose:!0,restoreFocus:!1,autoFocus:!1,data:{title:"Confirm Delete",bodyMessage:"Are you sure you want to delete this expense?",showYesNo:!0,showOk:!1}}).afterClosed().pipe((0,h.s)(1)).subscribe(e=>{e&&"yes"===e&&t?._id&&this._financeService.deleteExpense(t)})}getCols(){return[{headerName:"Expense",field:"title"},{headerName:"Day",field:"date",valueFormatter:e=>(0,f.n)(e.data.date),width:130,minWidth:130,maxWidth:130},{headerName:"Amount",field:"price",width:100,minWidth:100,maxWidth:100},{headerName:"Notes",field:"notes",width:100,minWidth:100,maxWidth:300},{headerName:"",cellRenderer:w._,width:100,minWidth:100,maxWidth:100,sortable:!1,filter:!1,resizable:!1,pinned:"right",hide:!this.isAdmin}]}onWindowResize(t){this.innerWidth=window.innerWidth}static#e=this.\u0275fac=function(e){return new(e||n)(i.rXU(g.bZ),i.rXU(A.m),i.rXU(N.F))};static#t=this.\u0275cmp=i.VBU({type:n,selectors:[["app-expenses"]],hostBindings:function(e,o){1&e&&i.bIt("resize",function(){return o.onWindowResize()},!1,i.tSv)},features:[i.Vt3],decls:2,vars:14,consts:[[3,"config","hide","next","previous"],[2,"width","100%","min-height","340px","height","calc(100vh - 240px)",3,"rowHeight","columnDefs","defaultColDef","rowData","pagination","paginationAutoPageSize","gridReady"]],template:function(e,o){1&e&&(i.j41(0,"shared-changer",0),i.bIt("next",function(){return o.nextDay()})("previous",function(){return o.previousDay()}),i.k0s(),i.j41(1,"ag-grid-angular",1),i.bIt("gridReady",function(c){return o.onGridReady(c)}),i.k0s()),2&e&&(i.Y8G("config",i.eq3(12,B,o.date))("hide",!0),i.R7$(1),i.AVh("ag-theme-alpine","light"===o.$theme)("ag-theme-alpine-dark","dark"===o.$theme),i.Y8G("rowHeight",35)("columnDefs",o.columnDefs)("defaultColDef",o.defaultColDef)("rowData",o.rowData)("pagination",o.innerWidth>700)("paginationAutoPageSize",!0))},dependencies:[v.xs,F.i]})}return n})()}];let U=(()=>{class n{static#e=this.\u0275fac=function(e){return new(e||n)};static#t=this.\u0275mod=i.$C({type:n});static#s=this.\u0275inj=i.G2t({imports:[u.iI.forChild(I),u.iI]})}return n})();var R=s(2422),z=s(9334),H=s(5526),j=s(9182);let G=(()=>{class n{static#e=this.\u0275fac=function(e){return new(e||n)};static#t=this.\u0275mod=i.$C({type:n});static#s=this.\u0275inj=i.G2t({imports:[y.MD,U,v.$V,R.m,g.hM,z.H,H.V,j.O]})}return n})()}}]);