import{a as u,b as z,c as J,d as $}from"./chunk-WUGOVNDJ.js";import{a as q}from"./chunk-CFCMLOOB.js";import{b as L}from"./chunk-JWZPFOXC.js";import{a as Q}from"./chunk-Q7PONYZL.js";import"./chunk-6CYPE36V.js";import"./chunk-BPNGRFUY.js";import{a as j}from"./chunk-ONICS2XY.js";import{a as W}from"./chunk-5ML3MIDN.js";import{Ba as U,Ca as O,Y as H,ia as S,sa as N}from"./chunk-32GEDFAZ.js";import{$c as V,Cb as a,Da as k,Db as T,Eb as A,Ib as f,L as G,Nb as s,Ob as o,Oc as F,Pb as l,Wb as B,Yb as x,cd as I,fb as n,hc as v,ia as y,jc as C,kc as P,m as _,ma as E,oc as D,pc as M,qb as h,qc as R,rc as Y,xb as g,yc as p,zc as m}from"./chunk-OWBIYIKH.js";var K=i=>({date:i,format:"yyyy"}),X=()=>({text:"Bungalow Rentals",tag:"h4"}),Z=()=>({text:"Monthly Statistics",tag:"h4"}),ee=()=>({text:"Expenses",tag:"h4"}),te=()=>({text:"Sources",tag:"h4"}),ie=()=>({text:"Unpaid Reservations",tag:"h4"});function ne(i,r){if(i&1&&(s(0,"div",8),l(1,"div",9)(2,"div",9),o(),s(3,"div",10),l(4,"div",9),o(),s(5,"div",10),l(6,"div",9),o()),i&2){let t=x(2);n(),a("chart",t.bungalowsChart),n(),a("chart",t.monthlyChart),n(2),a("chart",t.expensesChart),n(2),a("chart",t.sourcesChart)}}function ae(i,r){if(i&1&&(s(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7),v(4),p(5,"number"),o()(),s(6,"div",6)(7,"div",7),v(8),p(9,"number"),o()(),s(10,"div",6)(11,"div",7),v(12),p(13,"number"),o()(),s(14,"div",6)(15,"div",7),v(16),p(17,"number"),o()(),s(18,"div",6)(19,"div",7),v(20),p(21,"number"),o()(),s(22,"div",6)(23,"div",7),v(24),p(25,"number"),o()()()(),g(26,ne,7,4)),i&2){let t=r,e=x();n(4),C("Total Reservations: ",m(5,10,(t==null?null:t.totalReservations)||0),""),n(4),C("Total Reservations Amount: $",m(9,12,(t==null?null:t.totalReservationAmount)||0),""),n(4),C("Total Payments: $",m(13,14,(t==null?null:t.totalRevenues)||0),""),n(4),C("Total Unpaid Amount: $",m(17,16,(t==null?null:t.totalUnpaidAmount)||0),""),n(4),C("Total Expenses: $",m(21,18,(t==null?null:t.totalExpenses)||0),""),n(3),A("text-bg-danger",((t==null?null:t.pnl)||0)<0),n(),P(" ",((t==null?null:t.pnl)||0)>=0?"Total Profit: $":"Total Loss: $","",m(25,20,(t==null?null:t.pnl)||0)," "),n(2),f(e.gridView()?-1:26)}}function se(i,r){if(i&1&&l(0,"ks-basic-grid",3),i&2){let t=x();a("config",t.bungalowsGridConfig)("refresh$",t.bungalowsGridRefresh)}}function oe(i,r){if(i&1&&l(0,"ks-basic-grid",3),i&2){let t=x();a("config",t.monthlyGridConfig)("refresh$",t.monthlyGridRefresh)}}function re(i,r){if(i&1&&l(0,"ks-basic-grid",3),i&2){let t=x();a("config",t.expensesGridConfig)("refresh$",t.expensesGridRefresh)}}function le(i,r){if(i&1&&l(0,"ks-basic-grid",3),i&2){let t=x();a("config",t.sourceGridConfig)("refresh$",t.sourceGridRefresh)}}function ce(i,r){if(i&1&&l(0,"ks-basic-grid",3),i&2){let t=x();a("config",t.unpaidGridConfig)("refresh$",t.unpaidGridRefresh)}}var Ge=(()=>{let r=class r{constructor(){this._destroyRef=y(k),this._navService=y(j),this._excelService=y($),this._configService=y(Q),this._reportsService=y(q),this._SessionService=y(L),this._user=this._SessionService.loggedInUser,this.gridView=h(!1),this.report$=this._reportsService.report$,this.yearSig=h(new Date().getFullYear()),this.dateSig=F(()=>new Date(this.yearSig(),0)),this.sourcesChart=new u,this.monthlyChart=new u,this.expensesChart=new u,this.bungalowsChart=new u,this.sourceGridRefresh=new _,this.unpaidGridRefresh=new _,this.monthlyGridRefresh=new _,this.expensesGridRefresh=new _,this.bungalowsGridRefresh=new _}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:W.LAYOUT.children.REPORTS.children.YEARLY.name,buttons:[{label:{text:"Download Excel"},prefixIcon:{icon:"icon_excel"},onClick:()=>this._saveExcel(),hide:!this._user?.admin},{label:{text:"Change View"},prefixIcon:{icon:"icon_grid_view"},onClick:()=>this._changeView()}]}),this._initializeGrids()}ngAfterViewInit(){this._getReport(),this._reportsService.report$.pipe(H(this._destroyRef)).subscribe(e=>this._reflectReport(e))}changeDate(e){this.yearSig.update(d=>d+(e==="next"?1:-1)),this._getReport()}_getReport(){this._reportsService.getYearlyReport(this.yearSig())}_changeView(){this.gridView.update(e=>!e),this.report$.pipe(G(1)).subscribe(e=>this._reflectReport(e))}_saveExcel(){this.report$.pipe(G(1)).subscribe(e=>{e&&this._excelService.createExcelReport({reportTitle:"Yearly Report",reportTimeFrame:this.yearSig().toString(),fields:[`Total Reservations: ${e.totalReservations}`,`Total Reservations Amount: $${e.totalReservationAmount}`,`Total Payments: $${e.totalRevenues}`,`Total Unpaid Amount: $${e.totalUnpaidAmount}`,`Total Expenses: $${e.totalExpenses}`,e.pnl<0?`Total Loss: $${e.pnl}`:`Total Profit: $${e.pnl}`],sheets:[{columns:this.bungalowsGridConfig?.columns||[],data:e.bungalows,title:"Bungalow Rentals"},{columns:this.monthlyGridConfig?.columns||[],data:e.months,title:"Monthly Statistics"},{columns:this.expensesGridConfig?.columns||[],data:e.expenses,title:"Expenses"},{columns:this.sourceGridConfig?.columns||[],data:e.sources,title:"Sources"},{columns:this.unpaidGridConfig?.columns||[],data:e.unpaidReservations,title:"Unpaid Reservations"}]},this._user?.name||"")})}_reflectReport(e){e&&(this._refreshGrids(e),this._drawCharts(e))}_refreshGrids(e){this.sourceGridRefresh.next({data:e.sources}),this.monthlyGridRefresh.next({data:e.months}),this.expensesGridRefresh.next({data:e.expenses}),this.bungalowsGridRefresh.next({data:e.bungalows}),this.unpaidGridRefresh.next({data:e.unpaidReservations})}_drawCharts(e){let d=S.mapObjectArrayToGroupedValues(e.months),c=S.mapObjectArrayToGroupedValues(e.bungalows),b=S.mapObjectArrayToGroupedValues(e.expenses),w=S.mapObjectArrayToGroupedValues(e.sources);this.monthlyChart=new u({chart:{type:"line"},title:{text:"Monthly Statistics"},credits:{enabled:!1},yAxis:{title:{text:"Amount in $"}},xAxis:{title:{text:"Month"},categories:d.monthName},series:[{type:"line",data:d.profits,name:"Result"},{type:"line",data:d.expenses,name:"Expenses"},{type:"line",data:d.revenues,name:"Revenues"}]}),this.expensesChart=new u({chart:{type:"column"},title:{text:"Expenses"},credits:{enabled:!1},yAxis:{title:{text:"Amount in $"}},xAxis:{type:"category",title:{text:"Expenses"},categories:b.expenseName},series:[{type:"column",data:b.amount,name:"Amount"}]}),this.sourcesChart=new u({chart:{type:"column"},title:{text:"Source"},credits:{enabled:!1},yAxis:{title:{text:"Quantity"}},xAxis:{type:"category",title:{text:"Source"},categories:w.source},series:[{type:"column",data:w.qtt,name:"Quantity"}]}),this.bungalowsChart=new u({chart:{type:"column"},title:{text:"Bungalow Rentals"},credits:{enabled:!1},yAxis:{title:{text:"Number of Rentals"}},xAxis:{type:"category",title:{text:"Bungalows"},categories:c.bungalowName},series:[{type:"column",data:c.reservations,name:"Reservations"}]})}_initializeGrids(){this.bungalowsGridConfig={data:h([]),hidePagination:!0,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,columns:[{field:"bungalowName",title:"Bungalow",type:"string"},{field:"reservations",title:"Reservations",type:"number"}]},this.expensesGridConfig={data:h([]),hidePagination:!0,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,columns:[{field:"expenseName",title:"Expense",type:"string"},{field:"amount",title:"Amount",type:"number",prefix:"$ "}]},this.sourceGridConfig={data:h([]),hidePagination:!0,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,columns:[{field:"source",title:"Source",type:"string"},{field:"qtt",title:"Quantity",type:"number"}]},this.monthlyGridConfig={data:h([]),hidePagination:!0,maxTableHeight:"700px",columns:[{field:"monthName",title:"Month",type:"string"},{field:"expenses",title:"Expenses",type:"number",prefix:"$ "},{field:"revenues",title:"Revenues",type:"number",prefix:"$ "},{field:"profits",title:"Result",type:"number",prefix:"$ "}]},this.unpaidGridConfig={data:h([]),hidePagination:!0,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,columns:[{field:"date",title:"Booking Date",type:"date",dateFormat:"dddd dd MMMM yyyy",extraStyles:{"min-width":"120px"}},{field:"bungalowName",title:"Bungalow",type:"string"},{field:"paid",title:"Paid",type:"number",prefix:"$ "},{field:"unpaid",title:"Unpaid",type:"number",prefix:"$ "}]}}};r.\u0275fac=function(d){return new(d||r)},r.\u0275cmp=E({type:r,selectors:[["ks-solutions-year-report"]],standalone:!0,features:[D([$]),M],decls:20,vars:27,consts:[[3,"btnClicked","config"],[1,"mt-4"],[3,"config"],[3,"config","refresh$"],[1,"container-fluid"],[1,"row","justify-content-center","text-center"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","p-2"],[1,"report-div"],[1,"cs-charts","mt-5"],[1,"one","cs-shadow",3,"chart"],[1,"pt-4"]],template:function(d,c){if(d&1&&(s(0,"ks-base-changer",0),B("btnClicked",function(w){return c.changeDate(w)}),o(),g(1,ae,27,22),p(2,"async"),s(3,"div")(4,"div",1),l(5,"ks-base-label",2),g(6,se,1,2,"ks-basic-grid",3),o(),s(7,"div",1),l(8,"ks-base-label",2),g(9,oe,1,2,"ks-basic-grid",3),o(),s(10,"div",1),l(11,"ks-base-label",2),g(12,re,1,2,"ks-basic-grid",3),o(),s(13,"div",1),l(14,"ks-base-label",2),g(15,le,1,2,"ks-basic-grid",3),o()(),s(16,"div",1),p(17,"async"),l(18,"ks-base-label",2),g(19,ce,1,2,"ks-basic-grid",3),o()),d&2){let b;a("config",Y(20,K,c.dateSig)),n(),f((b=m(2,16,c.report$))?1:-1,b),n(2),T("display",c.gridView()?"block":"none"),n(2),a("config",R(22,X)),n(),f(c.bungalowsGridConfig?6:-1),n(2),a("config",R(23,Z)),n(),f(c.monthlyGridConfig?9:-1),n(2),a("config",R(24,ee)),n(),f(c.expensesGridConfig?12:-1),n(2),a("config",R(25,te)),n(),f(c.sourceGridConfig?15:-1),n(),T("display",m(17,18,c.report$)?"block":"none"),n(2),a("config",R(26,ie)),n(),f(c.unpaidGridConfig?19:-1)}},dependencies:[I,J,z,O,U,N,V],styles:[".cs-charts[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px}@media (max-width: 850px){.cs-charts[_ngcontent-%COMP%]{grid-template-columns:1fr}}"],changeDetection:0});let i=r;return i})();export{Ge as ReportByYearComponent};
