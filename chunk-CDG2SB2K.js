import{a as r,b as v}from"./chunk-JWZPFOXC.js";import{a}from"./chunk-6CYPE36V.js";import{a as h}from"./chunk-5ML3MIDN.js";import{ja as S,ma as m,n as f,na as d}from"./chunk-32GEDFAZ.js";import{L as l,ca as u,ia as o,m as c,qb as g}from"./chunk-OWBIYIKH.js";var N=(()=>{let s=class s{constructor(){this._router=o(f),this._dialog=o(S),this._sessionService=o(v),this._networkService=o(m),this._storageService=o(d),this.isRefreshTokenCalled=!1,this.isLoggingIn=g(!1),this.isLogoutCalled=!1,this.refreshToken$=new c}changePassword(t,e){return this._networkService.post(a.USER.changePassword,{newPassword:t,oldPassword:e})}login(t,e){this.isLogoutCalled=!1,this.isLoggingIn.set(!0),this._networkService.post(a.AUTHENTICATION.login,{username:t,password:e}).pipe(l(1)).subscribe({next:i=>{i&&i.data&&(this.isLogoutCalled=!1,this.isRefreshTokenCalled=!1,this._storageService.setItem(r.SS.token,i.data.accessToken,!0),this._storageService.setItem(r.SS.username,i.data.username,!0),this._storageService.setItem(r.SS.name,i.data.name,!0),this._storageService.setItem(r.SS.user,i.data,!0),this._sessionService.updateUser(),this._router.navigateByUrl(h.LAYOUT.route)),this.isLoggingIn.set(!1)},error:()=>{this.isLoggingIn.set(!1)}})}logOut(t){this._dialog.closeAll();let e=this._storageService.getItem(r.SS.username,!0);!this.isLogoutCalled&&this._networkService.post(a.AUTHENTICATION.logout,{isFromInterceptor:t,username:e}).pipe(l(1)).subscribe(),this._storageService.clearAll([],!0),this._sessionService.updateUser(),this._router.navigateByUrl(h.LOGIN.route),this.refreshToken$.next(null),this.isLogoutCalled=!0}callRefreshToken(){return this._networkService.post(a.AUTHENTICATION.refresh,{})}successfulRefreshToken(t){let e=t.data?.accessToken;e?(this._storageService.setItem(r.SS.token,e,!0),this.isRefreshTokenCalled=!1,this.refreshToken$.next(e)):this.logOut(!0)}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"});let n=s;return n})();export{N as a};
