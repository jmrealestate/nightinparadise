import{b as H}from"./chunk-X6SDYXME.js";import{a as W}from"./chunk-JHOHYJWD.js";import{a as p}from"./chunk-TL6R7WHS.js";import{a as c}from"./chunk-US4DBW3U.js";import"./chunk-IXDNPNBC.js";import{a as l}from"./chunk-IA4DM2LR.js";import{a as L}from"./chunk-JU5LHE6N.js";import{a as V}from"./chunk-TRRKCROW.js";import{Y as B,Z as I,fa as P,ia as T,xa as U,ya as j}from"./chunk-XVDAFDV3.js";import{Cb as h,Da as S,Ib as D,L as o,Nb as R,Ob as E,Pb as M,Wb as k,Yb as F,ca as w,fb as b,ia as a,m as x,ma as _,n as g,oc as A,pc as N,qb as s,rc as $,x as y,xb as C,y as v}from"./chunk-PV357URW.js";var m=(()=>{let i=class i{constructor(){this._networkService=a(T),this._revenues$=new g([]),this.dateSig=s(new Date),this.filteredRevenues$=v([this._revenues$,I(this.dateSig)]).pipe(y(([e,t])=>{let r=(t.getMonth()+1).toString().padStart(2,"0"),f=t.getFullYear();return e.filter(d=>d.date.startsWith(`${f}-${r}`))}))}changeDate(e){this.dateSig.update(t=>{if(typeof e=="string"){let r=new Date(t);return r.setDate(15),e==="next"?r.setMonth(t.getMonth()+1):r.setMonth(t.getMonth()-1),r}else return new Date(e.year,e.month-1,15)})}getRevenues(){this._networkService.get(l.REVENUES).pipe(o(1)).subscribe({next:e=>{e.data&&this._revenues$.next(e.data)}})}deleteRevenue(e){this._networkService.delete(l.REVENUES,void 0,e._id).pipe(o(1)).subscribe(()=>{W.UpdateArrayBehaviorSubject(this._revenues$,e,"delete","_id")})}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=w({token:i,factory:i.\u0275fac});let n=i;return n})();var Y=n=>({date:n,format:"MMMM yyyy"});function G(n,i){if(n&1&&M(0,"ks-basic-grid",1),n&2){let u=F();h("config",u.gridConfig)("refresh$",u.refresh$)}}var me=(()=>{let i=class i{constructor(){this._dialog=a(P),this._destroyRef=a(S),this._navService=a(L),this._revenuesService=a(m),this.refresh$=new x,this._isAdmin=p(c.ADMIN),this._canDelete=p(c.DELETE_REVENUE),this.dateSig=this._revenuesService.dateSig}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:V.LAYOUT.children.REVENUES.name,buttons:[{label:{text:"Change Month"},prefixIcon:{icon:"icon_calendar"},onClick:()=>{this._openSearchByDate()}}]}),this._initializeGrid(),this._revenuesService.getRevenues()}ngAfterViewInit(){this._revenuesService.filteredRevenues$.pipe(B(this._destroyRef)).subscribe(e=>{this.refresh$.next({data:e})})}changeDate(e){this._revenuesService.changeDate(e)}_openSearchByDate(){let e={hideClearButton:!0,title:{text:"Change Month"},saveButton:{label:{text:"Search"},prefixIcon:{icon:"icon_search"},matType:"mat-stroked-button"},form:{value:{month:new Date().getMonth()+1,year:new Date().getFullYear()},fields:[{name:"month",label:{text:"Month"},type:"select",required:!0,options:H},{name:"year",label:{text:"Year"},type:"text",required:!0,onlyNumeric:!0,maxLength:4,minLength:4}]}};this._dialog.openFormPopup(e,"400px").afterClosed().pipe(o(1)).subscribe(t=>{t&&this._revenuesService.changeDate(t)})}_initializeGrid(){this.gridConfig={data:s([]),defaultPagination:100,maxTableHeight:"calc(100dvh - 115px - 50px - 50px - 50px - 80px)",noDataMessage:{text:"No Payments Found"},features:{showSearch:!0},columns:[{field:"customerName",title:"Payment",type:"string",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"}},{field:"amount",title:"Amount",type:"number",extraStyles:{"min-width":"100px","max-width":"100px",width:"100px"}},{field:"deletedReservation",title:"Reservation",type:"chip",extraStyles:{"max-width":"120px",width:"120px"},truthy:{false:"",true:"Canceled"},setChipClass:e=>e.deletedReservation===!0?"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120":""},{field:"notes",title:"Notes",type:"string",extraStyles:{"max-width":"300px","min-width":"150px"}},{field:"date",title:"Date",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"110px","max-width":"110px",width:"110px"}},{field:"createdBy",title:"Created By",type:"string",extraStyles:{"min-width":"120px","max-width":"120px",width:"120px"},hide:!this._isAdmin},{field:"createdAt",title:"Created At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"},hide:!this._isAdmin}],actionsColumn:{enabled:this._canDelete,maxButtons:window.innerWidth<700?1:void 0,width:window.innerWidth<700?void 0:"70px",maxWidth:window.innerWidth<700?void 0:"70px",minWidth:window.innerWidth<700?void 0:"70px",buttons:[{prefixIcon:{icon:"icon_delete"},color:"warn",label:{text:"Delete"},onClickFn:e=>this._deleteRevenue(e),matType:"mat-icon-button",isVisibleFn:()=>this._canDelete}]}}}_deleteRevenue(e){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this payment?"}}).afterClosed().pipe(o(1)).subscribe(t=>{t&&e?._id&&this._revenuesService.deleteRevenue(e)})}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=_({type:i,selectors:[["ks-solutions-revenues"]],standalone:!0,features:[A([m]),N],decls:2,vars:4,consts:[[3,"btnClicked","config"],[3,"config","refresh$"]],template:function(t,r){t&1&&(R(0,"ks-base-changer",0),k("btnClicked",function(d){return r.changeDate(d)}),E(),C(1,G,1,2,"ks-basic-grid",1)),t&2&&(h("config",$(2,Y,r.dateSig)),b(),D(r.gridConfig?1:-1))},dependencies:[U,j],changeDetection:0});let n=i;return n})();export{me as RevenuesComponent};
