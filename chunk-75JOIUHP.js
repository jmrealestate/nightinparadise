import{a as i,b as K,c as V,d as q,e as _,f as ae}from"./chunk-LMLVBBIX.js";import{a as H,b as ie}from"./chunk-PBZLLU35.js";import{c as I,d as te}from"./chunk-ICNAXN57.js";import{a as j,b as re}from"./chunk-TS6MWPKE.js";import"./chunk-2JAAJZAJ.js";import{a as O,b as ee}from"./chunk-CCRCP4DV.js";import{a as N,b as ne}from"./chunk-APVBAPPR.js";import{Ca as G,Ha as U,La as M,Ua as L,Wa as Z,ma as D,oa as X}from"./chunk-HBX2KYD3.js";import{$b as C,Ab as y,Bc as $,Cc as E,Fb as p,Ga as T,Lb as b,M as g,Qb as x,Rb as h,Sb as u,Vc as B,ba as J,dd as P,e as z,ib as s,la as a,md as Q,n as S,pa as R,rc as Y,sc as F,tb as f,tc as w,u as k,uc as A,v}from"./chunk-J2DESNEB.js";function le(r,o){if(r&1&&u(0,"ks-basic-grid",4),r&2){let m=C();p("config",m.summaryGridConfig)("refresh$",m.summaryGridRefresh)}}function pe(r,o){if(r&1&&(x(0,"div",5),u(1,"div",6)(2,"div",6)(3,"div",6)(4,"div",6),h()),r&2){let m=C();s(),p("chart",m.pnlChart),s(),p("chart",m.revenueChart),s(),p("chart",m.expenseChart),s(),p("chart",m.reservationChart)}}var se,oe,Fe,me=z(()=>{Q();B();X();q();Z();J();ne();re();ee();te();ae();ie();B();q();se=r=>({text:r,tag:"h3"}),oe=()=>({text:"Summary",tag:"h4"});Fe=(()=>{let o=class o{constructor(){this._destroyRef=a(T),this._dialog=a(G),this._navService=a(O),this._excelService=a(_),this._snackbar=a(U),this._configService=a(j),this._reportsService=a(H),this._sessionService=a(I),this._user=this._sessionService.loggedInUser,this.summary=f({expenses:0,pnl:0,reservations:0,revenues:0,unpaid:0}),this.selectedYears=f([new Date().getFullYear()-1,new Date().getFullYear()]),this.benchmark$=this._reportsService.benchmark$,this.pnlChart=new i,this.revenueChart=new i,this.expenseChart=new i,this.reservationChart=new i,this.unpaidChart=new i,this.summaryGridRefresh=new S}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:N.LAYOUT.children.REPORTS.children.BENCHMARK.name,buttons:[{label:{text:"Change Years"},prefixIcon:{icon:"icon_calendar"},onClick:()=>this._changeYears()},{label:{text:"Download Excel"},prefixIcon:{icon:"icon_excel"},onClick:()=>this._saveExcel(),hide:!this._user?.admin}]}),this._initGrid()}ngAfterViewInit(){this._getBenchmark(),this.benchmark$.pipe(D(this._destroyRef)).subscribe(t=>{t&&this._reflectBenchmark(t)})}_changeYears(){let t={title:{text:"Change Years"},form:{value:{from:this.selectedYears()[0]??0,to:this.selectedYears()[this.selectedYears().length-1]},fields:[{label:{text:"From Year"},required:!0,name:"from",type:"number",integer:!0,disableNegativeValues:!0,range:{max:"to"}},{label:{text:"To Year"},required:!0,name:"to",type:"number",integer:!0,disableNegativeValues:!0,range:{min:"from"}}]},beforeCloseObservable:e=>e.from&&e.to&&Math.abs(e.from-e.to)>4?(this._snackbar.open({text:"Maximum allowed year gap is 5 year."},"error"),v(()=>"")):e.from!==void 0&&e.to!==void 0&&e.from>=e.to?(this._snackbar.open({text:"From year should be smaller than to year."},"error"),v(()=>"")):k(e)};this._dialog.openFormPopup(t,"500px").afterClosed().pipe(g(1)).subscribe(e=>{if(e){let{from:l,to:c}=e,n=c-l,d=Array.from({length:n+1},(ce,W)=>l+W);this.selectedYears.set(d),this._getBenchmark()}})}_getBenchmark(){this._reportsService.getBenchmarkReport(this.selectedYears())}_reflectBenchmark(t){let{benchmark:e,summary:l}=t,c=e.map(n=>({year:n.year,pnl:n.pnl,revenues:n.totalRevenues,expenses:n.totalExpenses,unpaid:n.totalUnpaidAmount,reservations:n.totalReservations}));this.summaryGridRefresh.next({data:c}),this.summary.set(c.reduce((n,d)=>(n.expenses+=d.expenses,n.pnl+=d.pnl,n.reservations+=d.reservations,n.revenues+=d.revenues,n.unpaid+=d.unpaid,n),{expenses:0,pnl:0,reservations:0,revenues:0,unpaid:0})),this._drawCharts(l)}_drawCharts(t){this.pnlChart=new i({chart:{type:"line"},title:{text:"Profit / Loss Trend"},credits:{enabled:!1},xAxis:{categories:t.pnlTrend.map(e=>e.year.toString()),title:{text:"Year"}},yAxis:{title:{text:"PnL ($)"}},series:[{type:"line",data:t.pnlTrend.map(e=>e.pnl),name:"PnL"}]}),this.revenueChart=new i({chart:{type:"column"},title:{text:"Total Revenues per Year"},credits:{enabled:!1},xAxis:{categories:t.revenueTrend.map(e=>e.year.toString()),title:{text:"Year"}},yAxis:{title:{text:"Amount ($)"}},series:[{type:"column",data:t.revenueTrend.map(e=>e.totalRevenues),name:"Revenues"}]}),this.expenseChart=new i({chart:{type:"column"},title:{text:"Total Expenses per Year"},credits:{enabled:!1},xAxis:{categories:t.expenseTrend.map(e=>e.year.toString()),title:{text:"Year"}},yAxis:{title:{text:"Amount ($)"}},series:[{type:"column",data:t.expenseTrend.map(e=>e.totalExpenses),name:"Expenses"}]}),this.reservationChart=new i({chart:{type:"column"},title:{text:"Total Reservations per Year"},credits:{enabled:!1},xAxis:{categories:t.reservationsTrend.map(e=>e.year.toString()),title:{text:"Year"}},yAxis:{title:{text:"Count"}},series:[{type:"column",data:t.reservationsTrend.map(e=>e.totalReservations),name:"Reservations"}]}),this.unpaidChart=new i({chart:{type:"line"},title:{text:"Unpaid Amount Trend"},credits:{enabled:!1},xAxis:{categories:t.unpaidTrend.map(e=>e.year.toString()),title:{text:"Year"}},yAxis:{title:{text:"Unpaid ($)"}},series:[{type:"line",data:t.unpaidTrend.map(e=>e.totalUnpaidAmount),name:"Unpaid Amount"}]})}_initGrid(){this.summaryGridConfig={data:f([]),hidePagination:!0,showFooter:!0,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,columns:[{field:"year",title:"Year",type:"number",setFooterContentFn:()=>"Total"},{field:"reservations",title:"Reservations",type:"number",setFooterContentFn:()=>this.summary()?.reservations},{field:"revenues",title:"Total Revenues",type:"number",prefix:"$ ",setFooterContentFn:()=>"$ "+this.summary()?.revenues},{field:"expenses",title:"Total Expenses",type:"number",prefix:"$ ",setFooterContentFn:()=>"$ "+this.summary()?.expenses},{field:"unpaid",title:"Unpaid Amount",type:"number",prefix:"$ ",setFooterContentFn:()=>"$ "+this.summary()?.unpaid},{field:"pnl",title:"Profit / Loss",type:"number",prefix:"$ ",setFooterContentFn:()=>"$ "+this.summary()?.pnl}]}}_saveExcel(){this.benchmark$.pipe(g(1)).subscribe(t=>{t&&this._excelService.createExcelReport({reportTitle:"Benchmark Report",reportTimeFrame:this.selectedYears().join(", "),fields:["Benchmark Summary by Year"],sheets:[{columns:this.summaryGridConfig?.columns||[],data:t.benchmark.map(e=>({year:e.year,pnl:e.pnl,revenues:e.totalRevenues,expenses:e.totalExpenses,unpaid:e.totalUnpaidAmount,reservations:e.totalReservations})),title:"Benchmark Summary"}]},this._user?.name||"")})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=R({type:o,selectors:[["ks-solutions-benchmark-report"]],standalone:!0,features:[Y([_]),F],decls:8,vars:9,consts:[[1,"container-fluid","mt-3","text-center"],[3,"config"],[1,"container-fluid"],[1,"mt-4"],[3,"config","refresh$"],[1,"cs-charts","mt-5"],[1,"one","cs-shadow",3,"chart"]],template:function(e,l){if(e&1&&(x(0,"div",0),u(1,"ks-base-label",1),h(),x(2,"div",2)(3,"div",3),u(4,"ks-base-label",1),y(5,le,1,2,"ks-basic-grid",4),h(),y(6,pe,5,4,"div",5),$(7,"async"),h()),e&2){let c;s(),p("config",A(6,se,"Report For "+l.selectedYears().join(" "))),s(3),p("config",w(8,oe)),s(),b(l.summaryGridConfig?5:-1),s(),b((c=E(7,4,l.benchmark$))?6:-1,c)}},dependencies:[V,K,L,M,P],styles:[".cs-charts[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:20px}@media (max-width: 850px){.cs-charts[_ngcontent-%COMP%]{grid-template-columns:1fr}}"],changeDetection:0});let r=o;return r})()});me();export{Fe as ReportBenchmarkComponent};
