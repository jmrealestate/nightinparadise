import{a as r,b as L,c as k,d as w}from"./chunk-VAAUDI2H.js";import{a,b as R}from"./chunk-UOQFKZ5Q.js";import{a as h,b as A}from"./chunk-DKBVEZ2J.js";import{Ba as d,Ca as v,Sa as C,p as S,r as _,ya as m}from"./chunk-P2MZAAVA.js";import{M as l,Vc as f,ba as T,ca as p,e as I,fa as u,la as o,n as c,tb as g}from"./chunk-LUSYJMV7.js";var B,U=I(()=>{"use strict";f();_();C();T();p();R();A();L();w();f();B=(()=>{let s=class s{constructor(){this._router=o(S),this._dialog=o(m),this._sessionService=o(k),this._networkService=o(d),this._storageService=o(v),this.isRefreshTokenCalled=!1,this.isLoggingIn=g(!1),this.isLogoutCalled=!1,this.refreshToken$=new c}changePassword(t,e){return this._networkService.post(a.USER.changePassword,{newPassword:t,oldPassword:e})}login(t,e){this.isLogoutCalled=!1,this.isLoggingIn.set(!0),this._networkService.post(a.AUTHENTICATION.login,{username:t,password:e}).pipe(l(1)).subscribe({next:i=>{i&&i.data&&(this.isLogoutCalled=!1,this.isRefreshTokenCalled=!1,this._storageService.setItem(r.SS.token,i.data.accessToken,!0),this._storageService.setItem(r.SS.username,i.data.username,!0),this._storageService.setItem(r.SS.name,i.data.name,!0),this._storageService.setItem(r.SS.user,i.data,!0),this._sessionService.updateUser(),this._router.navigateByUrl(h.LAYOUT.route)),this.isLoggingIn.set(!1)},error:()=>{this.isLoggingIn.set(!1)}})}logOut(t){this._dialog.closeAll();let e=this._storageService.getItem(r.SS.username,!0);!this.isLogoutCalled&&this._networkService.post(a.AUTHENTICATION.logout,{isFromInterceptor:t,username:e}).pipe(l(1)).subscribe(),this._storageService.clearAll([],!0),this._sessionService.updateUser(),this._router.navigateByUrl(h.LOGIN.route),this.refreshToken$.next(null),this.isLogoutCalled=!0}callRefreshToken(){return this._networkService.post(a.AUTHENTICATION.refresh,{})}successfulRefreshToken(t){let e=t.data?.accessToken;e?(this._storageService.setItem(r.SS.token,e,!0),this.isRefreshTokenCalled=!1,this.refreshToken$.next(e)):this.logOut(!0)}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"});let n=s;return n})()});export{B as a,U as b};
