"use strict";(self.webpackChunkpos=self.webpackChunkpos||[]).push([[72],{691:(O,v,n)=>{n.r(v),n.d(v,{RevenuesModule:()=>Y});var C=n(177),m=n(7062),w=n(4412),c=n(6977),d=n(6697),b=n(1335),R=n(9751),M=n(6994),p=n(2646),W=n(7442),g=n(6933),y=n(8103),$=n(312),A=n(6834),u=n(2288),S=n(5572),i=n(7705),x=n(5351),E=n(1010),F=n(8895),D=n(3524),B=n(6744);const I=function(s){return{date:s,format:"MMMM yyyy"}};var h=function(s){return s.new="Create New",s.search="Search By Date",s.downloadExcel="Download Excel",s}(h||{});const U=[{path:"",component:(()=>{class s extends b.${constructor(t,e,o){super(o),this._dialog=t,this._financeService=e,this._navService=o,this.innerWidth=window.innerWidth,this.isAdmin=(0,g.o)(y.m.admin),this.isEditor=(0,g.o)(y.m.editor),this.columnDefs=this.getCols(),this.defaultColDef={initialWidth:140,sortable:!0,resizable:!0,filter:!0,flex:1,minWidth:140},this.date=new Date,this.revenues$=new w.t([])}ngOnInit(){const t=[{label:h.search,prefixIcon:{icon:"calendar_today"}}];(this.isAdmin||this.isEditor)&&t.push({label:h.new,prefixIcon:{icon:"add_circle"}}),this.isAdmin&&t.unshift({label:h.downloadExcel,prefixIcon:{icon:"library_books"}}),this.Navbar_Update({show:!0,back:!1,title:this.NAV_NAMES.FINANCE.children.REVENUE.name,buttons:t}),this.NavButtons$.pipe((0,c.Q)(this.__unsubscribe$)).subscribe(e=>{e===h.new?this.openUserPopup():e===h.search?this.openSearch():e===h.downloadExcel&&this.downloadExcel()}),this._financeService.getAllRevenues(),this._financeService.expChanges$.pipe((0,c.Q)(this.__unsubscribe$)).subscribe(e=>{"edit"===e.state?this.openUserPopup(e.exp):"delete"===e.state&&this.onDeleteUser(e.exp)}),this._financeService.revenues$.pipe((0,c.Q)(this.__unsubscribe$)).subscribe(e=>this.getByMonth())}ngOnDestroy(){super.ngOnDestroy(),this._financeService.expChanges$.next({})}onGridReady(t){this.revenues$.pipe((0,c.Q)(this.__unsubscribe$)).subscribe(e=>{e&&(this.rowData=e)})}previousDay(){const t=new Date(this.date);t.setDate(15),t.setMonth(this.date.getMonth()-1),this.date=t,this.getByMonth()}nextDay(){const t=new Date(this.date);t.setDate(15),t.setMonth(this.date.getMonth()+1),this.date=t,this.getByMonth()}downloadExcel(){this._financeService.revenues$.pipe((0,d.s)(1)).subscribe(t=>{this._dialog.open(S.B,{width:"95vw",maxWidth:"300px",maxHeight:"95vh",disableClose:!0,restoreFocus:!1}).afterClosed().pipe((0,d.s)(1)).subscribe(e=>{e&&e.year&&function N(s,f){if(!s&&!Array.isArray(s))return;const t=(0,A.pA)(new Date).replaceAll(" ","_"),e=[];s.reverse().forEach(a=>{let l={};l=f?{Revenue:a.title,Day:(0,p.n)(a.date),Amount:a.price,Notes:a.notes}:{Expense:a.title,Day:(0,p.n)(a.date),Amount:a.price,Notes:a.notes},e.push(l)});const o=u.Wp.json_to_sheet(e);o["!cols"]=[{width:50},{width:20},{width:20},{width:30}];const r=u.Wp.book_new();u.Wp.book_append_sheet(r,o,f?"Revenues":"Expenses"),(0,u._h)(r,`${f?"Revenues":"Expenses"}_At_${t}.xlsx`)}(t.filter(r=>new Date(r.date).getFullYear()===e.year),!0)})})}getByMonth(){this._financeService.revenues$.pipe((0,d.s)(1)).subscribe(t=>{const e=t.filter(o=>{const r=new Date(o.date),a=r.getMonth(),l=r.getFullYear();return a===this.date.getMonth()&&l===this.date.getFullYear()});this.revenues$.next(e)})}openSearch(){this._dialog.open(W.n,{width:"95vw",maxWidth:"400px",disableClose:!0,restoreFocus:!1,autoFocus:!0}).afterClosed().pipe((0,d.s)(1)).subscribe(t=>{t&&t.date&&(this.date=t.date,this.getByMonth())})}openUserPopup(t){this._dialog.open($.y,{width:"95vw",maxWidth:"400px",maxHeight:"95vh",disableClose:!0,autoFocus:!t,restoreFocus:!1,data:{title:"Revenue",data:t}}).afterClosed().pipe((0,d.s)(1)).subscribe(e=>{e&&t&&this._financeService.editRevenue(e),e&&!t&&this._financeService.addNewRevenue(e)})}onDeleteUser(t){this._dialog.open(R.r,{width:"95vw",maxWidth:"500px",disableClose:!0,restoreFocus:!1,autoFocus:!1,data:{title:"Confirm Delete",bodyMessage:"Are you sure you want to delete this revenue?",showYesNo:!0,showOk:!1}}).afterClosed().pipe((0,d.s)(1)).subscribe(e=>{e&&"yes"===e&&t?._id&&this._financeService.deleteRevenue(t)})}getCols(){return[{headerName:"Revenue",field:"title"},{headerName:"Day",field:"date",valueFormatter:e=>(0,p.n)(e.data.date),width:130,minWidth:130,maxWidth:130},{headerName:"Amount",field:"price",width:100,minWidth:100,maxWidth:100},{headerName:"Notes",field:"notes",width:100,minWidth:100,maxWidth:300},{headerName:"",cellRenderer:M._,width:100,minWidth:100,maxWidth:100,sortable:!1,filter:!1,resizable:!1,pinned:"right",hide:!this.isAdmin}]}onWindowResize(t){this.innerWidth=window.innerWidth}static#e=this.\u0275fac=function(e){return new(e||s)(i.rXU(x.bZ),i.rXU(E.m),i.rXU(F.F))};static#t=this.\u0275cmp=i.VBU({type:s,selectors:[["app-revenues"]],hostBindings:function(e,o){1&e&&i.bIt("resize",function(){return o.onWindowResize()},!1,i.tSv)},features:[i.Vt3],decls:2,vars:14,consts:[[3,"config","hide","next","previous"],[2,"width","100%","min-height","340px","height","calc(100vh - 240px)",3,"rowHeight","columnDefs","defaultColDef","rowData","pagination","paginationAutoPageSize","gridReady"]],template:function(e,o){1&e&&(i.j41(0,"shared-changer",0),i.bIt("next",function(){return o.nextDay()})("previous",function(){return o.previousDay()}),i.k0s(),i.j41(1,"ag-grid-angular",1),i.bIt("gridReady",function(a){return o.onGridReady(a)}),i.k0s()),2&e&&(i.Y8G("config",i.eq3(12,I,o.date))("hide",!0),i.R7$(1),i.AVh("ag-theme-alpine","light"===o.$theme)("ag-theme-alpine-dark","dark"===o.$theme),i.Y8G("rowHeight",35)("columnDefs",o.columnDefs)("defaultColDef",o.defaultColDef)("rowData",o.rowData)("pagination",o.innerWidth>700)("paginationAutoPageSize",!0))},dependencies:[D.xs,B.i]})}return s})()}];let z=(()=>{class s{static#e=this.\u0275fac=function(e){return new(e||s)};static#t=this.\u0275mod=i.$C({type:s});static#n=this.\u0275inj=i.G2t({imports:[m.iI.forChild(U),m.iI]})}return s})();var H=n(2422),j=n(9334),V=n(5526),G=n(9182);let Y=(()=>{class s{static#e=this.\u0275fac=function(e){return new(e||s)};static#t=this.\u0275mod=i.$C({type:s});static#n=this.\u0275inj=i.G2t({imports:[C.MD,z,D.$V,H.m,x.hM,j.H,V.V,G.O]})}return s})()}}]);