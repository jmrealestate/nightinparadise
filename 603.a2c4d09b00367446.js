"use strict";(self.webpackChunkpos=self.webpackChunkpos||[]).push([[603],{2603:(H,p,s)=>{s.r(p),s.d(p,{ExpensesModule:()=>J});var y=s(6814),u=s(3403),D=s(5619),d=s(9773),h=s(8180),E=s(6775),w=s(8532),C=s(8018),f=s(8223),M=s(6261),m=s(9017),g=s(5994),b=s(9153),A=s(7022),l=s(1486),i=s(5879),x=s(7700),S=s(5937),W=s(1961),v=s(5083),$=s(5850);const B=function(n){return{date:n,format:"MMMM yyyy"}};var r=function(n){return n.new="Create New",n.search="Change Date",n.downloadExcel="Download Excel",n}(r||{});const F=[{path:"",component:(()=>{class n extends E.H{constructor(e,t,o){super(o),this._dialog=e,this._financeService=t,this._navService=o,this.innerWidth=window.innerWidth,this.isAdmin=(0,m.q)(g.l.admin),this.isEditor=(0,m.q)(g.l.editor),this.columnDefs=this.getCols(),this.defaultColDef={initialWidth:140,sortable:!0,resizable:!0,filter:!0,flex:1,minWidth:140},this.date=new Date,this.expenses$=new D.X([])}ngOnInit(){const e=[{label:r.search,prefixIcon:{icon:"calendar_today"}}];(this.isAdmin||this.isEditor)&&e.push({label:r.new,prefixIcon:{icon:"add_circle"}}),this.isAdmin&&e.unshift({label:r.downloadExcel,prefixIcon:{icon:"library_books"}}),this.Navbar_Update({show:!0,back:!1,title:this.NAV_NAMES.FINANCE.children.EXPENSE.name,buttons:e}),this.NavButtons$.pipe((0,d.R)(this.__unsubscribe$)).subscribe(t=>{t===r.new?this.openUserPopup():t===r.search?this.openSearch():t===r.downloadExcel&&this.downloadExcel()}),this._financeService.getAllExpenses(),this._financeService.expChanges$.pipe((0,d.R)(this.__unsubscribe$)).subscribe(t=>{"edit"===t.state?this.openUserPopup(t.exp):"delete"===t.state&&this.onDeleteUser(t.exp)}),this._financeService.expenses$.pipe((0,d.R)(this.__unsubscribe$)).subscribe(t=>this.getByMonth())}ngOnDestroy(){super.ngOnDestroy(),this._financeService.expChanges$.next({})}onGridReady(e){this.expenses$.pipe((0,d.R)(this.__unsubscribe$)).subscribe(t=>{t&&(this.rowData=t)})}previousDay(){const e=new Date(this.date);e.setMonth(this.date.getMonth()-1),e.setDate(15),this.date=e,this.getByMonth()}nextDay(){const e=new Date(this.date);e.setMonth(this.date.getMonth()+1),e.setDate(15),this.date=e,this.getByMonth()}downloadExcel(){this._financeService.expenses$.pipe((0,h.q)(1)).subscribe(e=>{!function N(n){if(!n&&!Array.isArray(n))return;const T=(0,A.fK)(new Date).replaceAll(" ","_"),e=[];n.forEach(a=>{e.push({Expense:a.title,Day:(0,f.M)(a.date),Amount:a.price,Notes:a.notes})});const t=l.P6.json_to_sheet(e);t["!cols"]=[{width:50},{width:20},{width:20},{width:30}];const o=l.P6.book_new();l.P6.book_append_sheet(o,t,"Expenses"),(0,l.NC)(o,`Expenses_At_${T}.xlsx`)}(e)})}getByMonth(){this._financeService.expenses$.pipe((0,h.q)(1)).subscribe(e=>{const t=e.filter(o=>{const a=new Date(o.date),c=a.getMonth(),j=a.getFullYear();return c===this.date.getMonth()&&j===this.date.getFullYear()});this.expenses$.next(t)})}openSearch(){this._dialog.open(M.T,{width:"95vw",maxWidth:"400px",disableClose:!0,restoreFocus:!1,autoFocus:!0}).afterClosed().pipe((0,h.q)(1)).subscribe(e=>{e&&e.date&&(this.date=e.date,this.getByMonth())})}openUserPopup(e){this._dialog.open(b.G,{width:"95vw",maxWidth:"400px",maxHeight:"95vh",disableClose:!0,autoFocus:!e,restoreFocus:!1,data:{title:"Expense",data:e}}).afterClosed().pipe((0,h.q)(1)).subscribe(t=>{t&&e&&this._financeService.editExpense(t),t&&!e&&this._financeService.addNewExpense(t)})}onDeleteUser(e){this._dialog.open(w.P,{width:"95vw",maxWidth:"500px",disableClose:!0,restoreFocus:!1,autoFocus:!1,data:{title:"Confirm Delete",bodyMessage:"Are you sure you want to delete this expense?",showYesNo:!0,showOk:!1}}).afterClosed().pipe((0,h.q)(1)).subscribe(t=>{t&&"yes"===t&&e?._id&&this._financeService.deleteExpense(e)})}getCols(){return[{headerName:"Expense",field:"title"},{headerName:"Day",field:"date",valueFormatter:t=>(0,f.M)(t.data.date),width:130,minWidth:130,maxWidth:130},{headerName:"Amount",field:"price",width:100,minWidth:100,maxWidth:100},{headerName:"",cellRenderer:C.m,width:100,minWidth:100,maxWidth:100,sortable:!1,filter:!1,resizable:!1,pinned:"right",hide:!this.isAdmin}]}onWindowResize(e){this.innerWidth=window.innerWidth}static#e=this.\u0275fac=function(t){return new(t||n)(i.Y36(x.uw),i.Y36(S.w),i.Y36(W.t))};static#t=this.\u0275cmp=i.Xpm({type:n,selectors:[["app-expenses"]],hostBindings:function(t,o){1&t&&i.NdJ("resize",function(){return o.onWindowResize()},!1,i.Jf7)},features:[i.qOj],decls:2,vars:14,consts:[[3,"config","hide","next","previous"],[2,"width","100%","min-height","340px","height","calc(100vh - 240px)",3,"rowHeight","columnDefs","defaultColDef","rowData","pagination","paginationAutoPageSize","gridReady"]],template:function(t,o){1&t&&(i.TgZ(0,"shared-changer",0),i.NdJ("next",function(){return o.nextDay()})("previous",function(){return o.previousDay()}),i.qZA(),i.TgZ(1,"ag-grid-angular",1),i.NdJ("gridReady",function(c){return o.onGridReady(c)}),i.qZA()),2&t&&(i.Q6J("config",i.VKq(12,B,o.date))("hide",!0),i.xp6(1),i.ekj("ag-theme-alpine","light"===o.$theme)("ag-theme-alpine-dark","dark"===o.$theme),i.Q6J("rowHeight",35)("columnDefs",o.columnDefs)("defaultColDef",o.defaultColDef)("rowData",o.rowData)("pagination",o.innerWidth>700)("paginationAutoPageSize",!0))},dependencies:[v.N8,$.d]})}return n})()}];let R=(()=>{class n{static#e=this.\u0275fac=function(t){return new(t||n)};static#t=this.\u0275mod=i.oAB({type:n});static#s=this.\u0275inj=i.cJS({imports:[u.Bz.forChild(F),u.Bz]})}return n})();var z=s(9255),P=s(9781),I=s(7858);let J=(()=>{class n{static#e=this.\u0275fac=function(t){return new(t||n)};static#t=this.\u0275mod=i.oAB({type:n});static#s=this.\u0275inj=i.cJS({imports:[y.ez,R,v.sF,z.B,x.Is,P.n,I.j]})}return n})()}}]);