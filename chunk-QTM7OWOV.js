import{a as _,b as K,c as V,d as q,e as C,f as se}from"./chunk-LMLVBBIX.js";import{a as H,b as ie}from"./chunk-PBZLLU35.js";import{c as N,d as te}from"./chunk-ICNAXN57.js";import{a as L,b as re}from"./chunk-TS6MWPKE.js";import"./chunk-2JAAJZAJ.js";import{a as I,b as ee}from"./chunk-CCRCP4DV.js";import{a as j,b as ne}from"./chunk-APVBAPPR.js";import{Ca as G,Ha as M,La as U,Ua as O,Wa as Z,ma as P,oa as X}from"./chunk-HBX2KYD3.js";import{$b as b,Ab as x,Bc as $,Cc as B,Fb as p,Ga as F,Lb as g,M as v,Qb as y,Rb as h,Sb as c,Vc as E,ba as J,dd as D,e as z,ib as m,la as s,md as Q,n as k,pa as R,rc as Y,sc as A,tb as u,tc as T,u as S,uc as w,v as f}from"./chunk-J2DESNEB.js";function le(i,a){if(i&1&&c(0,"ks-basic-grid",4),i&2){let d=b();p("config",d.summaryGridConfig)("refresh$",d.summaryGridRefresh)}}function me(i,a){if(i&1&&c(0,"div",5),i&2){let d=b();p("chart",d.combinedChart)}}var ae,oe,Ae,pe=z(()=>{Q();E();X();q();Z();J();ne();re();ee();te();se();ie();E();q();ae=i=>({text:i,tag:"h3"}),oe=()=>({text:"Summary",tag:"h4"});Ae=(()=>{let a=class a{constructor(){this._destroyRef=s(F),this._dialog=s(G),this._navService=s(I),this._excelService=s(C),this._snackbar=s(M),this._configService=s(L),this._reportsService=s(H),this._sessionService=s(N),this._user=this._sessionService.loggedInUser,this.summary=u({expenses:0,pnl:0,reservations:0,revenues:0,unpaid:0}),this.selectedYears=u([new Date().getFullYear()-1,new Date().getFullYear()]),this.benchmark$=this._reportsService.benchmark$,this.combinedChart=new _,this.summaryGridRefresh=new k}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:j.LAYOUT.children.REPORTS.children.BENCHMARK.name,buttons:[{label:{text:"Change Years"},prefixIcon:{icon:"icon_calendar"},onClick:()=>this._changeYears()},{label:{text:"Download Excel"},prefixIcon:{icon:"icon_excel"},onClick:()=>this._saveExcel(),hide:!this._user?.admin}]}),this._initGrid()}ngAfterViewInit(){this._getBenchmark(),this.benchmark$.pipe(P(this._destroyRef)).subscribe(n=>{n&&this._reflectBenchmark(n)})}_changeYears(){let n={title:{text:"Change Years"},form:{value:{from:this.selectedYears()[0]??0,to:this.selectedYears()[this.selectedYears().length-1]},fields:[{label:{text:"From Year"},required:!0,name:"from",type:"number",integer:!0,disableNegativeValues:!0,range:{max:"to"}},{label:{text:"To Year"},required:!0,name:"to",type:"number",integer:!0,disableNegativeValues:!0,range:{min:"from"}}]},beforeCloseObservable:e=>e.from&&e.to&&Math.abs(e.from-e.to)>4?(this._snackbar.open({text:"Maximum allowed year gap is 5 year."},"error"),f(()=>"")):e.from!==void 0&&e.to!==void 0&&e.from>=e.to?(this._snackbar.open({text:"From year should be smaller than to year."},"error"),f(()=>"")):S(e)};this._dialog.openFormPopup(n,"500px").afterClosed().pipe(v(1)).subscribe(e=>{if(e){let{from:t,to:o}=e,r=o-t,l=Array.from({length:r+1},(ce,W)=>t+W);this.selectedYears.set(l),this._getBenchmark()}})}_getBenchmark(){this._reportsService.getBenchmarkReport(this.selectedYears())}_reflectBenchmark(n){let{benchmark:e,summary:t}=n,o=e.map(r=>({year:r.year,pnl:r.pnl,revenues:r.totalRevenues,expenses:r.totalExpenses,unpaid:r.totalUnpaidAmount,reservations:r.totalReservations}));this.summaryGridRefresh.next({data:o}),this.summary.set(o.reduce((r,l)=>(r.expenses+=l.expenses,r.pnl+=l.pnl,r.reservations+=l.reservations,r.revenues+=l.revenues,r.unpaid+=l.unpaid,r),{expenses:0,pnl:0,reservations:0,revenues:0,unpaid:0})),this._drawCharts(t)}_drawCharts(n){let e=n.pnlTrend.map(t=>t.year.toString());this.combinedChart=new _({title:{text:"Benchmark Overview"},credits:{enabled:!1},xAxis:[{categories:e,crosshair:!0,title:{text:"Year"}}],yAxis:[{labels:{format:"${value}",style:{color:"#007bff"}},title:{text:"Amount ($)",style:{color:"#007bff"}}},{title:{text:"Reservations (count)",style:{color:"#28a745"}},labels:{format:"{value}",style:{color:"#28a745"}},opposite:!0}],tooltip:{shared:!0},legend:{align:"center",verticalAlign:"bottom"},series:[{type:"spline",name:"Revenues",data:n.revenueTrend.map(t=>t.totalRevenues??null),color:"#007bff",yAxis:0},{type:"spline",name:"Expenses",data:n.expenseTrend.map(t=>t.totalExpenses??null),color:"#dc3545",yAxis:0},{type:"spline",name:"PnL",data:n.pnlTrend.map(t=>t.pnl??null),color:"#ffc107",yAxis:0,marker:{enabled:!0}},{type:"spline",name:"Unpaid Amount",data:n.unpaidTrend.map(t=>t.totalUnpaidAmount??null),color:"#6f42c1",dashStyle:"ShortDot",yAxis:0},{type:"spline",name:"Reservations",data:n.reservationsTrend.map(t=>t.totalReservations??null),color:"#28a745",yAxis:1}]})}_initGrid(){this.summaryGridConfig={data:u([]),hidePagination:!0,showFooter:!0,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,columns:[{field:"year",title:"Year",type:"number",setFooterContentFn:()=>"Total"},{field:"reservations",title:"Reservations",type:"number",setFooterContentFn:()=>this.summary()?.reservations},{field:"revenues",title:"Total Revenues",type:"number",prefix:"$ ",setFooterContentFn:()=>"$ "+this.summary()?.revenues},{field:"expenses",title:"Total Expenses",type:"number",prefix:"$ ",setFooterContentFn:()=>"$ "+this.summary()?.expenses},{field:"unpaid",title:"Unpaid Amount",type:"number",prefix:"$ ",setFooterContentFn:()=>"$ "+this.summary()?.unpaid},{field:"pnl",title:"Profit / Loss",type:"number",prefix:"$ ",setFooterContentFn:()=>"$ "+this.summary()?.pnl}]}}_saveExcel(){this.benchmark$.pipe(v(1)).subscribe(n=>{n&&this._excelService.createExcelReport({reportTitle:"Benchmark Report",reportTimeFrame:this.selectedYears().join(", "),fields:["Benchmark Summary by Year"],sheets:[{columns:this.summaryGridConfig?.columns||[],data:n.benchmark.map(e=>({year:e.year,pnl:e.pnl,revenues:e.totalRevenues,expenses:e.totalExpenses,unpaid:e.totalUnpaidAmount,reservations:e.totalReservations})),title:"Benchmark Summary"}]},this._user?.name||"")})}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=R({type:a,selectors:[["ks-solutions-benchmark-report"]],standalone:!0,features:[Y([C]),A],decls:8,vars:9,consts:[[1,"container-fluid","mt-3","text-center"],[3,"config"],[1,"container-fluid"],[1,"mt-4"],[3,"config","refresh$"],[1,"one","cs-shadow","mt-4",3,"chart"]],template:function(e,t){if(e&1&&(y(0,"div",0),c(1,"ks-base-label",1),h(),y(2,"div",2)(3,"div",3),c(4,"ks-base-label",1),x(5,le,1,2,"ks-basic-grid",4),h(),x(6,me,1,1,"div",5),$(7,"async"),h()),e&2){let o;m(),p("config",w(6,ae,"Report For "+t.selectedYears().join(" "))),m(3),p("config",T(8,oe)),m(),g(t.summaryGridConfig?5:-1),m(),g((o=B(7,4,t.benchmark$))?6:-1,o)}},dependencies:[V,K,O,U,D],styles:[".cs-charts[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:20px}@media (max-width: 850px){.cs-charts[_ngcontent-%COMP%]{grid-template-columns:1fr}}"],changeDetection:0});let i=a;return i})()});pe();export{Ae as ReportBenchmarkComponent};
