import{a as r}from"./chunk-IXDNPNBC.js";import{a}from"./chunk-IA4DM2LR.js";import{a as c}from"./chunk-TRRKCROW.js";import{fa as S,ia as m,ja as d,n as f}from"./chunk-XVDAFDV3.js";import{L as l,ca as g,ha as o,m as h,qb as u}from"./chunk-PV357URW.js";var N=(()=>{let i=class i{constructor(t,e,s,k){this._dialog=t,this._networkService=e,this._storageService=s,this._router=k,this.isRefreshTokenCalled=!1,this.isLoggingIn=u(!1),this.isLogoutCalled=!1,this.refreshToken$=new h}changePassword(t,e){return this._networkService.post(a.USER.changePassword,{newPassword:t,oldPassword:e})}login(t,e){this.isLogoutCalled=!1,this.isLoggingIn.set(!0),this._networkService.post(a.AUTHENTICATION.login,{username:t,password:e}).pipe(l(1)).subscribe({next:s=>{s&&s.data&&(this.isLogoutCalled=!1,this.isRefreshTokenCalled=!1,this._storageService.setItem(r.SS.token,s.data.accessToken,!0),this._storageService.setItem(r.SS.username,s.data.username,!0),this._storageService.setItem(r.SS.name,s.data.name,!0),this._storageService.setItem(r.SS.user,s.data,!0),this._router.navigateByUrl(c.LAYOUT.route)),this.isLoggingIn.set(!1)},error:()=>{this.isLoggingIn.set(!1)}})}logOut(t){this._dialog.closeAll();let e=this._storageService.getItem(r.SS.username,!0);!this.isLogoutCalled&&this._networkService.post(a.AUTHENTICATION.logout,{isFromInterceptor:t,username:e}).pipe(l(1)).subscribe(),this._storageService.clearAll([],!0),this._router.navigateByUrl(c.LOGIN.route),this.refreshToken$.next(null),this.isLogoutCalled=!0}callRefreshToken(){return this._networkService.post(a.AUTHENTICATION.refresh,{})}successfulRefreshToken(t){let e=t.data?.accessToken;e?(this._storageService.setItem(r.SS.token,e,!0),this.isRefreshTokenCalled=!1,this.refreshToken$.next(e)):this.logOut(!0)}};i.\u0275fac=function(e){return new(e||i)(o(S),o(m),o(d),o(f))},i.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();export{N as a};
