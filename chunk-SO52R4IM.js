import{a as z}from"./chunk-CXG5DA6O.js";import{a as K}from"./chunk-JHOHYJWD.js";import{a as h}from"./chunk-JE5EXO4F.js";import{b as L}from"./chunk-JWZPFOXC.js";import{a as G}from"./chunk-Q7PONYZL.js";import{a as l}from"./chunk-6CYPE36V.js";import"./chunk-BPNGRFUY.js";import{a as H}from"./chunk-ONICS2XY.js";import{a as O}from"./chunk-5ML3MIDN.js";import{Ba as j,Ca as V,Y as I,Z as P,ja as T,ma as U}from"./chunk-32GEDFAZ.js";import{Cb as d,Da as w,Ib as R,L as a,Nb as E,Ob as k,Pb as M,Wb as A,Yb as $,a as u,b as v,ca as x,fb as C,ia as s,m as g,ma as b,n as y,oc as N,pc as F,qb as o,rc as B,x as S,xb as D,y as _}from"./chunk-OWBIYIKH.js";var p=(()=>{let t=class t{constructor(){this._networkService=s(U),this._revenues$=new y([]),this.date=o(new Date),this.filteredRevenues$=_([this._revenues$,P(this.date)]).pipe(S(([e,i])=>{let r=(i.getMonth()+1).toString().padStart(2,"0"),f=i.getFullYear();return e.filter(c=>c.date.startsWith(`${f}-${r}`))}))}changeDate(e){this.date.update(i=>{if(typeof e=="string"){let r=new Date(i);return r.setDate(15),e==="next"?r.setMonth(i.getMonth()+1):r.setMonth(i.getMonth()-1),r}else return new Date(e.year,e.month-1,15)})}getRevenues(){this._networkService.get(l.REVENUES).pipe(a(1)).subscribe({next:e=>{e.data&&this._revenues$.next(e.data)}})}deleteRevenue(e){this._networkService.delete(l.REVENUES,void 0,e._id).pipe(a(1)).subscribe(()=>{K.UpdateArrayBehaviorSubject(this._revenues$,e,"delete","_id")})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=x({token:t,factory:t.\u0275fac});let n=t;return n})();var Y=n=>({date:n,format:"MMMM yyyy"});function q(n,t){if(n&1&&M(0,"ks-basic-grid",1),n&2){let m=$();d("config",m.gridConfig)("refresh$",m.refresh$)}}var ge=(()=>{let t=class t{constructor(){this._destroyRef=s(w),this._dialog=s(T),this._navService=s(H),this._sharedService=s(z),this._configService=s(G),this._sessionService=s(L),this._revenuesService=s(p),this.date=this._revenuesService.date,this.refresh$=new g,this._isAdmin=this._sessionService.checkAccess(h.ADMIN),this._canDelete=this._sessionService.checkAccess(h.DELETE_REVENUE)}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:O.LAYOUT.children.REVENUES.name,buttons:[{label:{text:"Change Month"},prefixIcon:{icon:"icon_calendar"},onClick:()=>this._openSearchByDate()}]}),this._initializeGrid(),this._revenuesService.getRevenues()}ngAfterViewInit(){this._revenuesService.filteredRevenues$.pipe(I(this._destroyRef)).subscribe(e=>{this.refresh$.next({data:e})})}changeDate(e){this._revenuesService.changeDate(e)}_openSearchByDate(){this._sharedService.openSearchByDate().pipe(a(1)).subscribe(e=>e&&this._revenuesService.changeDate(e))}_initializeGrid(){this.gridConfig={data:o([]),defaultPagination:100,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearchAndChanger,noDataMessage:{text:"No Payments Found"},features:{showSearch:!0},columns:[{field:"customerName",title:"Payment",type:"string",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"}},{field:"amount",title:"Amount",type:"number",extraStyles:{"min-width":"100px","max-width":"100px",width:"100px"}},{field:"deletedReservation",title:"Reservation",type:"chip",extraStyles:{"max-width":"120px",width:"120px"},truthy:{false:"",true:"Canceled"},setChipClass:e=>e.deletedReservation===!0?"rounded rounded-5 px-3 py-1 text-bg-danger":""},{field:"notes",title:"Notes",type:"string",extraStyles:{"max-width":"300px","min-width":"150px"}},{field:"date",title:"Date",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"110px","max-width":"110px",width:"110px"}},{field:"createdBy",title:"Created By",type:"string",extraStyles:{"min-width":"120px","max-width":"120px",width:"120px"},hide:!this._isAdmin},{field:"createdAt",title:"Created At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"},hide:!this._isAdmin}],actionsColumn:v(u({},this._configService.getActionColumn(1)),{enabled:this._canDelete,buttons:[{prefixIcon:{icon:"icon_delete"},color:"warn",label:{text:"Delete"},onClickFn:e=>this._deleteRevenue(e),matType:"mat-icon-button",isVisibleFn:()=>this._canDelete}]})}}_deleteRevenue(e){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this payment?"}}).afterClosed().pipe(a(1)).subscribe(i=>{i&&e?._id&&this._revenuesService.deleteRevenue(e)})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=b({type:t,selectors:[["ks-solutions-revenues"]],standalone:!0,features:[N([p]),F],decls:2,vars:4,consts:[[3,"btnClicked","config"],[3,"config","refresh$"]],template:function(i,r){i&1&&(E(0,"ks-base-changer",0),A("btnClicked",function(c){return r.changeDate(c)}),k(),D(1,q,1,2,"ks-basic-grid",1)),i&2&&(d("config",B(2,Y,r.date)),C(),R(r.gridConfig?1:-1))},dependencies:[j,V],changeDetection:0});let n=t;return n})();export{ge as RevenuesComponent};
