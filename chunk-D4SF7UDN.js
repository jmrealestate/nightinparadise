import{a as J,b as se}from"./chunk-TGXXUL5Z.js";import{a as q,b as re}from"./chunk-H62IVGHA.js";import{a as Q,b as ae}from"./chunk-QHM7Z56U.js";import{a as l,b as ie}from"./chunk-DQYI455W.js";import{c as W,d as ee}from"./chunk-GRXY2UCV.js";import{a as p,b as ne}from"./chunk-UOQFKZ5Q.js";import{a as K,b as Z}from"./chunk-AOMHIDTB.js";import{a as Y,b as te}from"./chunk-DKBVEZ2J.js";import{Ca as H,Fa as L,Ua as O,Va as G,Wa as z,ma as U,na as j,oa as V}from"./chunk-OZNJVQIE.js";import{$b as B,Ab as k,Fb as h,Ga as R,Lb as M,M as a,Qb as A,Rb as $,Sb as N,Vc as c,Zb as F,a as v,b as g,ba as b,e as y,fa as C,ib as E,la as s,n as S,o as _,pa as D,rc as I,sc as P,tb as o,uc as T,y as x,z as w}from"./chunk-LUSYJMV7.js";var m,X=y(()=>{"use strict";c();V();z();b();ne();ae();c();m=(()=>{let t=class t{constructor(){this._networkService=s(L),this._revenues$=new _([]),this.date=o(new Date),this.filteredRevenues$=w([this._revenues$,j(this.date)]).pipe(x(([e,i])=>{let r=(i.getMonth()+1).toString().padStart(2,"0"),u=i.getFullYear();return e.filter(d=>d.date.startsWith(`${u}-${r}`))}))}changeDate(e){this.date.update(i=>{if(typeof e=="string"){let r=new Date(i);return r.setDate(15),e==="next"?r.setMonth(i.getMonth()+1):r.setMonth(i.getMonth()-1),r}else return new Date(e.year,e.month-1,15)})}getRevenues(){this._networkService.get(p.REVENUES).pipe(a(1)).subscribe({next:e=>{e.data&&this._revenues$.next(e.data)}})}deleteRevenue(e){this._networkService.delete(p.REVENUES,void 0,e._id).pipe(a(1)).subscribe(()=>{Q.UpdateArrayBehaviorSubject(this._revenues$,e,"delete","_id")})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=C({token:t,factory:t.\u0275fac});let n=t;return n})()});function de(n,t){if(n&1&&N(0,"ks-basic-grid",1),n&2){let f=B();h("config",f.gridConfig)("refresh$",f.refresh$)}}var ce,Ne,he=y(()=>{c();V();z();b();X();te();re();Z();ee();se();ie();c();ce=n=>({date:n,format:"MMMM yyyy"});Ne=(()=>{let t=class t{constructor(){this._destroyRef=s(R),this._dialog=s(H),this._navService=s(K),this._sharedService=s(J),this._configService=s(q),this._sessionService=s(W),this._revenuesService=s(m),this.date=this._revenuesService.date,this.refresh$=new S,this._isAdmin=this._sessionService.checkAccess(l.ADMIN),this._canDelete=this._sessionService.checkAccess(l.DELETE_REVENUE)}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:Y.LAYOUT.children.REVENUES.name,buttons:[{label:{text:"Change Month"},prefixIcon:{icon:"icon_calendar"},onClick:()=>this._openSearchByDate()}]}),this._initializeGrid(),this._revenuesService.getRevenues()}ngAfterViewInit(){this._revenuesService.filteredRevenues$.pipe(U(this._destroyRef)).subscribe(e=>{this.refresh$.next({data:e})})}changeDate(e){this._revenuesService.changeDate(e)}_openSearchByDate(){this._sharedService.openSearchByDate().pipe(a(1)).subscribe(e=>e&&this._revenuesService.changeDate(e))}_initializeGrid(){this.gridConfig={data:o([]),defaultPagination:100,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,noDataMessage:{text:"No Payments Found"},features:{showSearch:!0},columns:[{field:"customerName",title:"Payment",type:"string",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"}},{field:"amount",title:"Amount",type:"number",extraStyles:{"min-width":"100px","max-width":"100px",width:"100px"}},{field:"deletedReservation",title:"Reservation",type:"chip",extraStyles:{"max-width":"120px",width:"120px"},truthy:{false:"",true:"Canceled"},setChipClass:e=>e.deletedReservation===!0?"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120":""},{field:"notes",title:"Notes",type:"string",extraStyles:{"max-width":"300px","min-width":"150px"}},{field:"date",title:"Date",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"110px","max-width":"110px",width:"110px"}},{field:"createdBy",title:"Created By",type:"string",extraStyles:{"min-width":"120px","max-width":"120px",width:"120px"},hide:!this._isAdmin},{field:"createdAt",title:"Created At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"},hide:!this._isAdmin}],actionsColumn:g(v({},this._configService.getActionColumn(1)),{enabled:this._canDelete,buttons:[{prefixIcon:{icon:"icon_delete"},color:"warn",label:{text:"Delete"},onClickFn:e=>this._deleteRevenue(e),matType:"mat-icon-button",isVisibleFn:()=>this._canDelete}]})}}_deleteRevenue(e){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this payment?"}}).afterClosed().pipe(a(1)).subscribe(i=>{i&&e?._id&&this._revenuesService.deleteRevenue(e)})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=D({type:t,selectors:[["ks-solutions-revenues"]],standalone:!0,features:[I([m]),P],decls:2,vars:4,consts:[[3,"btnClicked","config"],[3,"config","refresh$"]],template:function(i,r){i&1&&(A(0,"ks-base-changer",0),F("btnClicked",function(d){return r.changeDate(d)}),$(),k(1,de,1,2,"ks-basic-grid",1)),i&2&&(h("config",T(2,ce,r.date)),E(),M(r.gridConfig?1:-1))},dependencies:[O,G],changeDetection:0});let n=t;return n})()});he();export{Ne as RevenuesComponent};
