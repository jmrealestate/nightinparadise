import{a as ce,b as be}from"./chunk-MBDYABHJ.js";import{a as u,b as Pe}from"./chunk-DQYI455W.js";import{a as se,b as Ue,c as f,d as P}from"./chunk-PVQPB666.js";import{a as T,b as pe}from"./chunk-UOQFKZ5Q.js";import{a as ae,b as ke}from"./chunk-ITSNA3JG.js";import{a as o,b}from"./chunk-DKBVEZ2J.js";import{Ca as C,Ea as re,Ga as O,Ha as R,Ta as ie,Wa as v,b as K,ba as ne,ca as Le,d as z,e as $,f as X,g as Z,i as ye,j as J,k as Q,l as q,m as ee,o as te,p as d,q as oe,r as E}from"./chunk-OX4MXTMU.js";import{Fb as V,Gb as B,I as w,J as N,M as y,Q as M,Qb as k,Rb as W,Sb as U,Vc as l,aa as x,ba as D,e as c,f as Ne,h as I,ib as L,la as r,pa as G,sc as j,tb as H,uc as F,v as S}from"./chunk-LUSYJMV7.js";var Ye,me,le=c(()=>{"use strict";l();E();v();ke();P();l();Ye=e=>({loading:e,disableInteractions:!0}),me=(()=>{let t=class t{constructor(){this._router=r(d),this._navService=r(ae),this._sessionService=r(f),this._keyBlocked=!1,this.loadingRouteSig=H(!1)}ngOnInit(){this._sessionService.updateUser(),this._navService.getThemeOnLoad(),document.addEventListener("keydown",n=>{if(["Enter"," "].includes(n.key)){if(this._keyBlocked){n.preventDefault(),n.stopPropagation();return}this._keyBlocked=!0,setTimeout(()=>{this._keyBlocked=!1},300)}}),this._router.events.subscribe(n=>{n instanceof J?(this.loadingRouteSig.set(!0),window.scrollTo(0,0)):(n instanceof Q||n instanceof ee||n instanceof q)&&this.loadingRouteSig.set(!1)})}};t.\u0275fac=function(s){return new(s||t)},t.\u0275cmp=G({type:t,selectors:[["app-root"]],standalone:!0,features:[j],decls:4,vars:5,consts:[[1,"app-container"],[3,"config"],[1,"global-router-container"]],template:function(s,i){s&1&&(k(0,"div",0),U(1,"ks-loader-overlay",1),k(2,"div",2),U(3,"router-outlet"),W()()),s&2&&(L(),V("config",F(3,Ye,i.loadingRouteSig)),L(),B("display",i.loadingRouteSig()?"none":"block"))},dependencies:[te,ie],styles:[".app-container[_ngcontent-%COMP%], .app-container[_ngcontent-%COMP%]   .global-router-container[_ngcontent-%COMP%]{min-height:100dvh}"],changeDetection:0});let e=t;return e})()});var m,ue=c(()=>{"use strict";l();E();b();P();m=e=>{let t=r(d),p=r(f);if(!p.loggedInUser)return t.navigate([o.LOGIN.route]),!1;if(!e.data)return!0;let s=e.data.roles;if(!s||!Array.isArray(s)||s.length===0)return!0;let i=p.checkAccess(s);return!i&&t.navigate([o.NOT_AUTHORIZED.route]),i}});var de,fe=c(()=>{"use strict";l();E();b();P();de=()=>{let e=r(d);return r(f).loggedInUser?(e.navigate([o.LAYOUT.route]),!1):!0}});var we,he,ge=c(()=>{"use strict";b();ue();fe();Pe();we=[{path:"",redirectTo:o.LAYOUT.children.RESERVATIONS.endpoint,pathMatch:"full"},{path:o.LAYOUT.children.CUSTOMERS.endpoint,loadComponent:()=>import("./chunk-J4IA7UWR.js").then(e=>e.CustomersComponent),canActivate:[m]},{path:o.LAYOUT.children.RESERVATIONS.endpoint,loadComponent:()=>import("./chunk-O3NHAMY2.js").then(e=>e.ReservationsComponent),canActivate:[m]},{path:o.LAYOUT.children.BUNGALOWS.endpoint,loadComponent:()=>import("./chunk-CBQVHIFJ.js").then(e=>e.BungalowsComponent),canActivate:[m],data:{roles:[u.VIEW_BUNGALOW]}},{path:o.LAYOUT.children.REVIEWS.endpoint,loadComponent:()=>import("./chunk-6NK2P6EK.js").then(e=>e.ReviewsComponent),canActivate:[m],data:{roles:[u.VIEW_REVIEWS]}},{path:o.LAYOUT.children.REVENUES.endpoint,loadComponent:()=>import("./chunk-B2TIZMXO.js").then(e=>e.RevenuesComponent),canActivate:[m],data:{roles:[u.VIEW_REVENUE]}},{path:o.LAYOUT.children.EXPENSES.endpoint,loadComponent:()=>import("./chunk-7GAVRUQV.js").then(e=>e.ExpensesComponent),canActivate:[m],data:{roles:[u.VIEW_EXPENSE]}},{path:o.LAYOUT.children.USER_MANAGEMENT.endpoint,loadComponent:()=>import("./chunk-RR6TEF6P.js").then(e=>e.UsersComponent),canActivate:[m],data:{roles:[u.VIEW_USER]}},{path:o.LAYOUT.children.REPORTS.endpoint,loadComponent:()=>import("./chunk-VKVTVWNR.js").then(e=>e.ReportsComponent),canActivate:[m],data:{roles:[u.VIEW_REPORTS]},children:[{path:"",pathMatch:"full",redirectTo:o.LAYOUT.children.REPORTS.children.YEARLY.endpoint},{path:o.LAYOUT.children.REPORTS.children.YEARLY.endpoint,loadComponent:()=>import("./chunk-QYUDXQAY.js").then(e=>e.ReportByYearComponent)}]}],he=[{path:"",redirectTo:o.HOME.endpoint,pathMatch:"full"},{path:o.HOME.endpoint,loadComponent:()=>import("./chunk-G7CC5OON.js").then(e=>e.MainPageComponent)},{path:o.LAYOUT.endpoint,loadComponent:()=>import("./chunk-CYCKAY6D.js").then(e=>e.LayoutComponent),children:we,canActivate:[m]},{path:o.LOGIN.endpoint,loadComponent:()=>import("./chunk-6GJD655P.js").then(e=>e.LoginComponent),canActivate:[de]},{path:o.NOT_AUTHORIZED.endpoint,loadComponent:()=>import("./chunk-VUPD2LDN.js").then(e=>e.NotAuthorizedComponent)},{path:o.PAGE_NOT_FOUND.endpoint,loadComponent:()=>import("./chunk-F32SMTXX.js").then(e=>e.PageNotFoundComponent)},{path:"**",redirectTo:o.PAGE_NOT_FOUND.endpoint,pathMatch:"full"}]});var h,_=c(()=>{"use strict";pe();h={API_HOST:T.API_HOST.nip_prod,CONFIG_URL:"assets/config/nip.json"}});function A(e,t){return e.clone({setHeaders:{Authorization:"Bearer "+t.getItem(se.SS.token,!0)},withCredentials:!0})}var Y=c(()=>{"use strict";Ue()});var Se,ve=c(()=>{"use strict";l();v();D();Y();_();pe();be();Se=(e,t)=>{let p=r(C),n=r(ce),s=r(R),i=r(O),g;return t(e).pipe(M(()=>{if(g){let a=g;a.showMessage&&a.message&&(a.isDialog?p.openConfirmPopup({hideYesNo:!0,message:{text:a.message,translate:!1},title:{text:a.title??"Error",translate:!1}}):s.open({text:a.message,translate:!1},a.state??"error",{duration:a.snackbarDuration}))}}),w(a=>(g=a.error,a.status===401?e.url===h.API_HOST+T.AUTHENTICATION.refresh?(n.logOut(!0),S(()=>a)):n.isRefreshTokenCalled!==!0?(n.isRefreshTokenCalled=!0,n.callRefreshToken().pipe(y(1),N(Ie=>(n.successfulRefreshToken(Ie),t(A(e,i)))))):n.refreshToken$.pipe(y(1),N(()=>t(A(e,i)))):a.status===403?(n.isLogoutCalled||(p.closeAll(),p.openConfirmPopup({message:{text:"You don't have permission to access this resource."},title:{text:"Error"},hideYesNo:!0})),n.logOut(!0),S(()=>a)):a.status===0?(p.openConfirmPopup({message:[{tag:"span",text:"Please check your internet connection and ensure it is stable.",addClass:"fw-bold"},{tag:"span",text:"If the issue persists, please contact your administrator for further assistance."}],title:{text:"Something went wrong"},hideYesNo:!0}),S(()=>a)):S(()=>a))))}});var Ae,Ee=c(()=>{"use strict";X();l();v();D();Ae=(e,t)=>{let p=r(C),n=r(R);return t(e).pipe(x(s=>{if(s instanceof K&&s.body){let i=s.body;if(i.showMessage&&i.message)if(i.isDialog){let g={hideYesNo:!0,message:{text:i.message,translate:!1},title:{text:i.title??"Message",translate:!1}};p.openConfirmPopup(g)}else n.open({text:i.message,translate:!1},i.state??"success",{duration:i.snackbarDuration})}}))}});var Ce,Oe=c(()=>{"use strict";l();v();Y();Ce=(e,t)=>{let p=r(O);return t(A(e,p))}});var Re,Te=c(()=>{"use strict";X();Le();E();v();ge();_();ve();Ee();Oe();Re={providers:[oe(he),ne(),z($([Ce,Se,Ae])),re({iconSize:"md",locale:"en-GB",forceLocal:!0,defaultLang:"en",snackbarDuration:3e3,defaultLoaderType:"rings",defaultMaximumNumberLength:15,enableTranslationByDefault:!0,defaultMaximumAfterCommaLength:2,snackbarDefaultPositionY:"bottom",defaultDisableNegativeNumbers:!0,baseNetworkServiceUrl:h.API_HOST,storageSecretKey:"my_night_in_paradise_secret_Key"})]}});var xe=Ne(_e=>{ye();le();Te();_();I(_e,null,function*(){yield Me(),Z(me,Re).catch(e=>console.error(e))});function Me(){return I(this,null,function*(){let e=yield fetch(h.CONFIG_URL);if(!e.ok)throw new Error(`Failed to fetch config: ${e.status} ${e.statusText}`);let t=yield e.json();if(!t||Array.isArray(t)||typeof t!="object")throw new Error("Invalid config structure");localStorage.setItem("config",JSON.stringify(t))})}});export default xe();
