import{a as De,b as je}from"./chunk-H62IVGHA.js";import{a as _,b as Ae}from"./chunk-DQYI455W.js";import{c as j,d as Ue}from"./chunk-GRXY2UCV.js";import{a as A,b as Oe}from"./chunk-UOQFKZ5Q.js";import{a as Fe,b as Ne}from"./chunk-AOMHIDTB.js";import{a as Re,b as Ge}from"./chunk-DKBVEZ2J.js";import{Ca as we,Fa as be,Ia as Se,Ka as Ee,Ma as ye,Oa as ke,Ra as G,Ua as Ce,V as $,W as N,Wa as O,X as ae,da as E,fa as ce,ga as W,ha as m,ia as le,ja as de,ka as pe,la as me,ma as ue,oa as $e,pa as fe,qa as he,ra as ge,sa as ve,ta as xe,ua as _e}from"./chunk-OZNJVQIE.js";import{$b as U,Ab as F,Fb as c,Ga as ne,Lb as b,M as v,Mb as P,Ob as T,Pb as M,Qb as o,Rb as s,Sb as d,Vc as x,a as Z,b as ee,ba as te,e as B,fa as ie,ib as r,kc as h,la as g,lc as se,mc as S,n as V,pa as C,rc as re,sc as R,tb as oe,tc as l,wc as u,xc as H}from"./chunk-LUSYJMV7.js";function Ye(i,n){if(i&1&&(o(0,"div",6),d(1,"ks-base-icon",0),o(2,"span",7),h(3),s()()),i&2){let e=n.$implicit;r(),c("config",l(2,We)),r(2),se(e)}}function qe(i,n){if(i&1&&(o(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),d(3,"ks-base-icon",0),h(4),o(5,"span",4),h(6),s()()(),o(7,"div",5),T(8,Ye,4,3,"div",6,P),s()()),i&2){let e=n.$implicit;r(3),c("config",l(3,He)),r(),S(" ",e.day," "),r(2),S("(",e.time.length,")"),r(2),M(e.time)}}function ze(i,n){if(i&1&&(o(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),h(3),o(4,"span",4),h(5),s()()(),T(6,qe,10,4,"mat-expansion-panel",null,P),s()),i&2){let e=n.$implicit;r(3),S(" ",e.month," "),r(2),S("(",e.monthCount,")"),r(),M(e.days)}}function Ke(i,n){if(i&1&&(o(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),h(3),o(4,"span",4),h(5),s()()(),T(6,ze,8,2,"mat-expansion-panel",null,P),s()),i&2){let e=n.$implicit;r(3),S(" ",e.year," "),r(2),S("(",e.yearCount,")"),r(),M(e.months)}}var He,We,Ie,Pe=B(()=>{"use strict";x();ae();_e();O();x();_e();He=()=>({icon:"icon_calendar"}),We=()=>({icon:"icon_clock_alt"});Ie=(()=>{let n=class n{constructor(){this._dialogRef=g($),this.data=g(N),this.cardConfig={header:{title:{text:this.data.user.username+" Logins",tag:"h3",fontWeight:"700"},position:"center",suffixButton:{label:{text:"Close"},matType:"mat-icon-button",prefixIcon:{icon:"icon_x_circle"},onClick:()=>this._closeDialog()}},content:{addClass:"card"},footer:{position:"center",buttons:[{label:{text:"Close"},matType:"mat-flat-button",onClick:()=>this._dialogRef.close()}]}},this.dates=[]}ngOnInit(){this.dates=this.convertDates(this.data.dates)}handleDialogActions(t){(!t||t==="ok"||t==="cancel")&&this._closeDialog()}convertDates(t){let a=[];return t.forEach(p=>{let w=new Date(p),z=`${w.getFullYear()}`,K=w.toLocaleString("default",{month:"long"}),J=`${w.toLocaleString("default",{weekday:"long"})} ${w.getDate()}`,D=w.getHours(),Q=w.getMinutes(),X=w.getSeconds(),Be=D>=12?"PM":"AM";D=D%12||12;let Ve=`${(D<10?"0":"")+D}:${(Q<10?"0":"")+Q}:${(X<10?"0":"")+X} ${Be}`,y=a.find(I=>I.year===z);y||(y={year:z,yearCount:0,months:[]},a.push(y));let k=y.months.find(I=>I.month===K);k||(k={month:K,monthCount:0,days:[]},y.months.push(k));let L=k.days.find(I=>I.day===J);L||(L={day:J,time:[]},k.days.push(L)),L.time.push(Ve),k.monthCount++,y.yearCount++}),a}_closeDialog(){this._dialogRef.close()}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=C({type:n,selectors:[["ks-solutions-logs-popup"]],standalone:!0,features:[R],decls:6,vars:1,consts:[[3,"config"],[1,"container","py-2","cd-max"],[1,"row","justify-content-center","my-auto"],[1,"example-headers-align"],[1,"ms-auto"],[1,"px-5"],[1,"d-flex","align-items-center","gap-2"],[1,"text-break"]],template:function(a,p){a&1&&(o(0,"ks-base-card",0)(1,"div",1)(2,"div",2)(3,"mat-accordion",3),T(4,Ke,8,2,"mat-expansion-panel",null,P),s()()()()),a&2&&(c("config",p.cardConfig),r(4),M(p.dates))},dependencies:[G,xe,ve,fe,he,ge,Ee],styles:["@media (max-width: 600px){[_nghost-%COMP%]     .mat-expansion-panel-body{padding:10px 0!important}}"],changeDetection:0});let i=n;return i})()});function kt(i,n){i&1&&(o(0,"div",5),h(1,"You need to logout and login again to reflect changes"),s())}function Ct(i,n){if(i&1&&(o(0,"div",6),d(1,"ks-base-checkbox",0),s(),o(2,"div",6),d(3,"ks-base-checkbox",0),s()),i&2){let e=U();r(),c("config",u(3,f,!e.canEdit,l(2,it),e.form.controls.admin)),r(2),c("config",u(8,f,!e.canEdit,l(7,nt),e.form.controls.active))}}function Ft(i,n){if(i&1&&(o(0,"div",6),d(1,"ks-base-checkbox",0),s()),i&2){let e=U();r(),c("config",u(2,f,!e.canEdit,l(1,ot),e.form.controls.password))}}function Ut(i,n){i&1&&(o(0,"div",6)(1,"p",7),h(2,"Password: 00000"),s()())}function Rt(i,n){if(i&1&&(o(0,"div",3)(1,"div",8),h(2,"Reservations Permissions"),s(),o(3,"div",6),d(4,"ks-base-checkbox",0),s(),o(5,"div",6),d(6,"ks-base-checkbox",0),s(),o(7,"div",6),d(8,"ks-base-checkbox",0),s(),o(9,"div",8),h(10,"Bungalows Permissions"),s(),o(11,"div",6),d(12,"ks-base-checkbox",0),s(),o(13,"div",6),d(14,"ks-base-checkbox",0),s(),o(15,"div",6),d(16,"ks-base-checkbox",0),s(),o(17,"div",8),h(18,"Customers Permissions"),s(),o(19,"div",6),d(20,"ks-base-checkbox",0),s(),o(21,"div",8),h(22,"Reports Permissions"),s(),o(23,"div",6),d(24,"ks-base-checkbox",0),s(),o(25,"div",8),h(26,"Reviews Permissions"),s(),o(27,"div",6),d(28,"ks-base-checkbox",0),s(),o(29,"div",8),h(30,"Expenses Permissions"),s(),o(31,"div",6),d(32,"ks-base-checkbox",0),s(),o(33,"div",6),d(34,"ks-base-checkbox",0),s(),o(35,"div",6),d(36,"ks-base-checkbox",0),s(),o(37,"div",6),d(38,"ks-base-checkbox",0),s(),o(39,"div",8),h(40,"Payments Permissions"),s(),o(41,"div",6),d(42,"ks-base-checkbox",0),s(),o(43,"div",6),d(44,"ks-base-checkbox",0),s(),o(45,"div",6),d(46,"ks-base-checkbox",0),s(),o(47,"div",8),h(48,"User Management"),s(),o(49,"div",6),d(50,"ks-base-checkbox",0),s(),o(51,"div",6),d(52,"ks-base-checkbox",0),s(),o(53,"div",6),d(54,"ks-base-checkbox",0),s(),o(55,"div",6),d(56,"ks-base-checkbox",0),s()()),i&2){let e=U();r(4),c("config",u(21,f,!e.canEdit,l(20,st),e.form.controls.permissions.controls.addReservation)),r(2),c("config",u(26,f,!e.canEdit,l(25,rt),e.form.controls.permissions.controls.editReservation)),r(2),c("config",u(31,f,!e.canEdit,l(30,at),e.form.controls.permissions.controls.deleteReservation)),r(4),c("config",u(36,f,!e.canEdit,l(35,ct),e.form.controls.permissions.controls.viewBungalow)),r(2),c("config",u(41,f,!e.canEdit,l(40,lt),e.form.controls.permissions.controls.addBungalow)),r(2),c("config",u(46,f,!e.canEdit,l(45,dt),e.form.controls.permissions.controls.editBungalow)),r(4),c("config",u(51,f,!e.canEdit,l(50,pt),e.form.controls.permissions.controls.viewCustomers)),r(4),c("config",u(56,f,!e.canEdit,l(55,mt),e.form.controls.permissions.controls.viewReports)),r(4),c("config",u(61,f,!e.canEdit,l(60,ut),e.form.controls.permissions.controls.viewReviews)),r(4),c("config",u(66,f,!e.canEdit,l(65,ft),e.form.controls.permissions.controls.viewExpense)),r(2),c("config",u(71,f,!e.canEdit,l(70,ht),e.form.controls.permissions.controls.addExpense)),r(2),c("config",u(76,f,!e.canEdit,l(75,gt),e.form.controls.permissions.controls.editExpense)),r(2),c("config",u(81,f,!e.canEdit,l(80,vt),e.form.controls.permissions.controls.deleteExpense)),r(4),c("config",u(86,f,!e.canEdit,l(85,xt),e.form.controls.permissions.controls.viewRevenue)),r(2),c("config",u(91,f,!e.canEdit,l(90,_t),e.form.controls.permissions.controls.addRevenue)),r(2),c("config",u(96,f,!e.canEdit,l(95,wt),e.form.controls.permissions.controls.deleteRevenue)),r(4),c("config",u(101,f,!e.canEdit,l(100,bt),e.form.controls.permissions.controls.viewUser)),r(2),c("config",u(106,f,!e.canEdit,l(105,St),e.form.controls.permissions.controls.addUser)),r(2),c("config",u(111,f,!e.canEdit,l(110,Et),e.form.controls.permissions.controls.editUser)),r(2),c("config",u(116,f,!e.canEdit,l(115,yt),e.form.controls.permissions.controls.viewLogs))}}var Je,Qe,Xe,Ze,et,tt,it,f,nt,ot,st,rt,at,ct,lt,dt,pt,mt,ut,ft,ht,gt,vt,xt,_t,wt,bt,St,Et,yt,Te,Me=B(()=>{"use strict";x();me();ae();O();Ue();Ae();x();me();Je=()=>({text:"Username"}),Qe=()=>({preventInputSpace:!0,maxInputCharacters:20}),Xe=(i,n,e,t)=>({label:i,control:n,readonly:e,extra:t}),Ze=()=>({text:"Name"}),et=()=>({maxInputCharacters:20}),tt=(i,n,e,t)=>({label:i,control:n,extra:e,readonly:t}),it=()=>({text:"Admin"}),f=(i,n,e)=>({readonly:i,label:n,control:e}),nt=()=>({text:"Active"}),ot=()=>({text:"Reset Password To 00000"}),st=()=>({text:"Add Reservations"}),rt=()=>({text:"Modify Reservations"}),at=()=>({text:"Delete Reservations"}),ct=()=>({text:"View Bungalows"}),lt=()=>({text:"Add Bungalows"}),dt=()=>({text:"Modify Bungalows"}),pt=()=>({text:"View Customers"}),mt=()=>({text:"View Reports"}),ut=()=>({text:"View Reviews"}),ft=()=>({text:"View Expenses"}),ht=()=>({text:"Add Expenses"}),gt=()=>({text:"Modify Expenses"}),vt=()=>({text:"Delete Expenses"}),xt=()=>({text:"View Payments"}),_t=()=>({text:"Add Payments"}),wt=()=>({text:"Delete Payments"}),bt=()=>({text:"View Users"}),St=()=>({text:"Add Users"}),Et=()=>({text:"Modify Users"}),yt=()=>({text:"View Logs"});Te=(()=>{let n=class n{constructor(){this._sessionService=g(j),this._dialogRef=g($),this.data=g(N),this.loggedInUser=this._sessionService.loggedInUser,this.canEdit=this.data&&this._sessionService.checkAccess(_.EDIT_USER)||this._sessionService.checkAccess(_.ADD_USER),this.cardConfig={header:{title:{text:this.canEdit?this.data?"Edit User":"Add User":"User",tag:"h3",fontWeight:"700"},position:"center",suffixButton:{label:{text:"Close"},matType:"mat-icon-button",prefixIcon:{icon:"icon_x_circle"},onClick:()=>this._closeDialog()}},content:{addClass:"card"},footer:{position:"center",buttons:[this.canEdit?{label:{text:"Save"},matType:"mat-flat-button",prefixIcon:{icon:"icon_save"},onClick:()=>{this._submit()}}:{label:{text:"Close"},matType:"mat-flat-button",onClick:()=>{this._dialogRef.close()}}]}},this.form=new W({username:new m("",[E.required,E.minLength(4),E.maxLength(20)]),name:new m("",[E.required,E.minLength(4),E.maxLength(20)]),password:new m(!1),admin:new m(!1),active:new m(!1),passwordRetries:new m(0),permissions:new W({viewCustomers:new m(!1),viewReviews:new m(!1),viewLogs:new m(!1),viewReports:new m(!1),viewUser:new m(!1),addUser:new m(!1),editUser:new m(!1),deleteUser:new m(!1),viewRevenue:new m(!1),addRevenue:new m(!1),deleteRevenue:new m(!1),viewExpense:new m(!1),addExpense:new m(!1),editExpense:new m(!1),deleteExpense:new m(!1),viewBungalow:new m(!1),addBungalow:new m(!1),editBungalow:new m(!1),deleteBungalow:new m(!1),addReservation:new m(!1),editReservation:new m(!1),deleteReservation:new m(!1)})})}ngOnInit(){this.data&&this._editForm(this.data)}_closeDialog(t){this._dialogRef.close(t)}_submit(){Se(this.form)&&this._closeDialog(this._format(this.form.value))}_editForm(t){this.form.patchValue({username:t.username,name:t.name,admin:t.admin,active:t.active,passwordRetries:t.passwordRetries,permissions:t.permissions})}_format(t){let a={username:t.username,name:t.name,admin:!!t.admin,active:!!t.active,permissions:t.permissions,passwordRetries:t.active?0:t.passwordRetries};return(t.password||!this.data)&&(a.password="00000"),t.admin&&(a.permissions={}),a}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=C({type:n,selectors:[["ks-solutions-user-popup"]],standalone:!0,features:[R],decls:12,vars:22,consts:[[3,"config"],[1,"py-2",3,"formGroup"],[1,"container-fluid",2,"max-height","calc(100dvh - 220px)"],[1,"row"],[1,"col-12","col-lg-6",3,"config"],[1,"text-center","h4"],[1,"col-12","col-md-6","col-lg-4"],[1,"mt-2","ps-3","h5","mb-0"],[1,"col-12","h4","mt-4","mb-0"]],template:function(a,p){a&1&&(o(0,"ks-base-card",0)(1,"form",1)(2,"div",2)(3,"div",3),d(4,"ks-base-input",4)(5,"ks-base-input",4),s(),F(6,kt,2,0,"div",5),o(7,"div",3),F(8,Ct,4,12)(9,Ft,2,6,"div",6)(10,Ut,3,0,"div",6),s(),F(11,Rt,57,120,"div",3),s()()()),a&2&&(c("config",p.cardConfig),r(),c("formGroup",p.form),r(3),c("config",H(10,Xe,l(8,Je),p.form.controls.username,p.canEdit?!!p.data:!0,l(9,Qe))),r(),c("config",H(17,tt,l(15,Ze),p.form.controls.name,l(16,et),!p.canEdit)),r(),b(p.data&&p.form.value.username===(p.loggedInUser==null?null:p.loggedInUser.username)?6:-1),r(2),b(p.form.value.username!==(p.loggedInUser==null?null:p.loggedInUser.username)?8:-1),r(),b(p.data&&p.form.value.username!==(p.loggedInUser==null?null:p.loggedInUser.username)?9:p.data?-1:10),r(2),b(p.form.value.admin?-1:11))},dependencies:[G,ye,ke,pe,le,ce,de],changeDetection:0});let i=n;return i})()});var q,Le=B(()=>{"use strict";x();O();te();Oe();x();q=(()=>{let n=class n{constructor(){this._networkService=g(be),this._users$=new V,this.users$=this._users$.asObservable()}getAllUsers(){this._networkService.get(A.USERS.users).subscribe({next:t=>{this._users$.next(t.data?t.data:[])}})}addNewUser(t){this._networkService.post(A.USERS.users,t).pipe(v(1)).subscribe({next:()=>{this.getAllUsers()}})}getLogs(t){return this._networkService.get(A.USERS.tracking,t.username)}editUser(t){this._networkService.patch(A.USERS.users,t,t.username).pipe(v(1)).subscribe({next:()=>{this.getAllUsers()}})}deleteUser(t){this._networkService.delete(A.USERS.users,void 0,t.username).pipe(v(1)).subscribe({next:()=>{this.getAllUsers()}})}};n.\u0275fac=function(a){return new(a||n)},n.\u0275prov=ie({token:n,factory:n.\u0275fac});let i=n;return i})()});function At(i,n){if(i&1&&d(0,"ks-basic-grid",0),i&2){let e=U();c("config",e.gridConfig)("refresh$",e.refresh$)}}var gi,Dt=B(()=>{x();$e();O();te();Pe();Me();Le();Ge();je();Ne();Ue();Ae();x();gi=(()=>{let n=class n{constructor(){this._destroyRef=g(ne),this._dialog=g(we),this._userService=g(q),this._navService=g(Fe),this._configService=g(De),this._sessionService=g(j),this._loggedInUser=this._sessionService.loggedInUser,this._isAdmin=this._sessionService.checkAccess(_.ADMIN),this._canAdd=this._sessionService.checkAccess(_.ADD_USER),this._canEdit=this._sessionService.checkAccess(_.EDIT_USER),this._canViewLogs=this._sessionService.checkAccess(_.VIEW_LOGS),this.refresh$=new V}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:Re.LAYOUT.children.USER_MANAGEMENT.name,buttons:[{label:{text:"Add User"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._canAdd,onClick:()=>this._openUserPopup()}]}),this._initializeGrid(),this._userService.getAllUsers()}ngAfterViewInit(){this._userService.users$.pipe(ue(this._destroyRef)).subscribe(t=>{this.refresh$.next({data:t})})}_initializeGrid(){this.gridConfig={data:oe([]),defaultPagination:100,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,noDataMessage:{text:"No Users Found"},features:{showSearch:!0},columns:[{field:"username",title:"Username",type:"string",extraStyles:{"min-width":"150px"}},{field:"name",title:"Name",type:"string",extraStyles:{"min-width":"150px"}},{field:"admin",title:"Admin",type:"chip",extraStyles:{"max-width":"120px",width:"120px"},truthy:{false:"No",true:"Yes"},setChipClass:t=>t.admin===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"active",title:"Active",type:"chip",extraStyles:{"max-width":"120px",width:"120px"},truthy:{false:"No",true:"Yes"},setChipClass:t=>t.active===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"}],actionsColumn:ee(Z({},this._configService.getActionColumn(3)),{enabled:this._canEdit||this._canViewLogs||this._isAdmin,buttons:[{prefixIcon:{icon:"icon_clock_alt"},label:{text:"View Logins"},onClickFn:t=>this._openLogsPopup(t),isVisibleFn:()=>this._canViewLogs,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:t=>this._openUserPopup(t),isVisibleFn:()=>this._canEdit,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete"},color:"warn",label:{text:"Delete"},onClickFn:t=>this._deleteUser(t),isVisibleFn:t=>!!(t.username!==this._loggedInUser?.username&&this._isAdmin),matType:"mat-icon-button"}]})}}_openUserPopup(t){this._dialog.open(Te,{width:"95vw",maxWidth:"1000px",maxHeight:"95vh",disableClose:!0,autoFocus:!1,restoreFocus:!0,data:t}).afterClosed().pipe(v(1)).subscribe(a=>{a&&t?this._userService.editUser(a):a&&!t&&this._userService.addNewUser(a)})}_openLogsPopup(t){this._userService.getLogs(t).pipe(v(1)).subscribe(a=>{a&&a.data&&this._dialog.open(Ie,{width:"95vw",maxWidth:"500px",maxHeight:"95vh",disableClose:!0,autoFocus:!1,restoreFocus:!0,data:{user:t,dates:a.data.map(p=>p.date)}})})}_deleteUser(t){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this user?"}}).afterClosed().pipe(v(1)).subscribe(a=>{a&&t?.username&&this._userService.deleteUser(t)})}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=C({type:n,selectors:[["ks-solutions-users-listing"]],standalone:!0,features:[re([q]),R],decls:1,vars:1,consts:[[3,"config","refresh$"]],template:function(a,p){a&1&&F(0,At,1,2,"ks-basic-grid",0),a&2&&b(p.gridConfig?0:-1)},dependencies:[Ce],changeDetection:0});let i=n;return i})()});Dt();export{gi as UsersComponent};
