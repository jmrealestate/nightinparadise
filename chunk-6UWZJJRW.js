import{a as x}from"./chunk-JE5EXO4F.js";import{b as N}from"./chunk-JWZPFOXC.js";import{a as Se}from"./chunk-Q7PONYZL.js";import{a as R}from"./chunk-6CYPE36V.js";import"./chunk-BPNGRFUY.js";import{a as be}from"./chunk-ONICS2XY.js";import{a as we}from"./chunk-5ML3MIDN.js";import{$ as le,Ba as _e,K as B,L as V,Q as S,S as ne,T as O,U as m,V as oe,W as se,X as re,Y as ae,_ as ce,aa as de,ba as pe,ca as me,ja as ue,ma as fe,pa as he,ra as ge,ta as ve,va as xe,ya as $}from"./chunk-32GEDFAZ.js";import{Cb as c,Da as Z,Ib as b,Jb as I,L as v,Lb as P,Mb as T,Nb as o,Ob as s,Pb as d,Yb as F,a as J,b as Q,ca as X,fb as r,hc as h,ia as g,ic as te,jc as w,m as L,ma as k,oc as ie,pc as U,qb as ee,qc as l,tc as u,uc as G,xb as C}from"./chunk-OWBIYIKH.js";var Fe=()=>({icon:"icon_calendar"}),Ue=()=>({icon:"icon_clock_alt"});function Re(i,n){if(i&1&&(o(0,"div",6),d(1,"ks-base-icon",0),o(2,"span",7),h(3),s()()),i&2){let e=n.$implicit;r(),c("config",l(2,Ue)),r(2),te(e)}}function Ae(i,n){if(i&1&&(o(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),d(3,"ks-base-icon",0),h(4),o(5,"span",4),h(6),s()()(),o(7,"div",5),P(8,Re,4,3,"div",6,I),s()()),i&2){let e=n.$implicit;r(3),c("config",l(3,Fe)),r(),w(" ",e.day," "),r(2),w("(",e.time.length,")"),r(2),T(e.time)}}function De(i,n){if(i&1&&(o(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),h(3),o(4,"span",4),h(5),s()()(),P(6,Ae,10,4,"mat-expansion-panel",null,I),s()),i&2){let e=n.$implicit;r(3),w(" ",e.month," "),r(2),w("(",e.monthCount,")"),r(),T(e.days)}}function Ie(i,n){if(i&1&&(o(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),h(3),o(4,"span",4),h(5),s()()(),P(6,De,8,2,"mat-expansion-panel",null,I),s()),i&2){let e=n.$implicit;r(3),w(" ",e.year," "),r(2),w("(",e.yearCount,")"),r(),T(e.months)}}var Ee=(()=>{let n=class n{constructor(){this._dialogRef=g(B),this.data=g(V),this.cardConfig={header:{title:{text:this.data.user.username+" Logins",tag:"h3",fontWeight:"700"},position:"center",suffixButton:{label:{text:"Close"},matType:"mat-icon-button",prefixIcon:{icon:"icon_x_circle"},onClick:()=>this._closeDialog()}},content:{addClass:"card"},footer:{position:"center",buttons:[{label:{text:"Close"},matType:"mat-flat-button",onClick:()=>this._dialogRef.close()}]}},this.dates=[]}ngOnInit(){this.dates=this.convertDates(this.data.dates)}handleDialogActions(t){(!t||t==="ok"||t==="cancel")&&this._closeDialog()}convertDates(t){let a=[];return t.forEach(p=>{let _=new Date(p),W=`${_.getFullYear()}`,Y=_.toLocaleString("default",{month:"long"}),q=`${_.toLocaleString("default",{weekday:"long"})} ${_.getDate()}`,A=_.getHours(),z=_.getMinutes(),K=_.getSeconds(),ke=A>=12?"PM":"AM";A=A%12||12;let Ce=`${(A<10?"0":"")+A}:${(z<10?"0":"")+z}:${(K<10?"0":"")+K} ${ke}`,E=a.find(D=>D.year===W);E||(E={year:W,yearCount:0,months:[]},a.push(E));let y=E.months.find(D=>D.month===Y);y||(y={month:Y,monthCount:0,days:[]},E.months.push(y));let M=y.days.find(D=>D.day===q);M||(M={day:q,time:[]},y.days.push(M)),M.time.push(Ce),y.monthCount++,E.yearCount++}),a}_closeDialog(){this._dialogRef.close()}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=k({type:n,selectors:[["ks-solutions-logs-popup"]],standalone:!0,features:[U],decls:6,vars:1,consts:[[3,"config"],[1,"container","py-2","cd-max"],[1,"row","justify-content-center","my-auto"],[1,"example-headers-align"],[1,"ms-auto"],[1,"px-5"],[1,"d-flex","align-items-center","gap-2"],[1,"text-break"]],template:function(a,p){a&1&&(o(0,"ks-base-card",0)(1,"div",1)(2,"div",2)(3,"mat-accordion",3),P(4,Ie,8,2,"mat-expansion-panel",null,I),s()()()()),a&2&&(c("config",p.cardConfig),r(4),T(p.dates))},dependencies:[$,me,pe,ce,le,de,ge],styles:["@media (max-width: 600px){[_nghost-%COMP%]     .mat-expansion-panel-body{padding:10px 0!important}}"],changeDetection:0});let i=n;return i})();var Pe=()=>({text:"Username"}),Te=()=>({preventInputSpace:!0,maxInputCharacters:20}),Me=(i,n,e,t)=>({label:i,control:n,readonly:e,extra:t}),Le=()=>({text:"Name"}),Be=()=>({maxInputCharacters:20}),Ve=(i,n,e,t)=>({label:i,control:n,extra:e,readonly:t}),$e=()=>({text:"Admin"}),f=(i,n,e)=>({readonly:i,label:n,control:e}),Ne=()=>({text:"Active"}),Ge=()=>({text:"Reset Password To 00000"}),Oe=()=>({text:"Add Reservations"}),je=()=>({text:"Modify Reservations"}),He=()=>({text:"Delete Reservations"}),We=()=>({text:"View Bungalows"}),Ye=()=>({text:"Add Bungalows"}),qe=()=>({text:"Modify Bungalows"}),ze=()=>({text:"View Customers"}),Ke=()=>({text:"View Reports"}),Je=()=>({text:"View Reviews"}),Qe=()=>({text:"View Expenses"}),Xe=()=>({text:"Add Expenses"}),Ze=()=>({text:"Modify Expenses"}),et=()=>({text:"Delete Expenses"}),tt=()=>({text:"View Payments"}),it=()=>({text:"Add Payments"}),nt=()=>({text:"Delete Payments"}),ot=()=>({text:"View Users"}),st=()=>({text:"Add Users"}),rt=()=>({text:"Modify Users"}),at=()=>({text:"View Logs"});function ct(i,n){i&1&&(o(0,"div",5),h(1,"You need to logout and login again to reflect changes"),s())}function lt(i,n){if(i&1&&(o(0,"div",6),d(1,"ks-base-checkbox",0),s(),o(2,"div",6),d(3,"ks-base-checkbox",0),s()),i&2){let e=F();r(),c("config",u(3,f,!e.canEdit,l(2,$e),e.form.controls.admin)),r(2),c("config",u(8,f,!e.canEdit,l(7,Ne),e.form.controls.active))}}function dt(i,n){if(i&1&&(o(0,"div",6),d(1,"ks-base-checkbox",0),s()),i&2){let e=F();r(),c("config",u(2,f,!e.canEdit,l(1,Ge),e.form.controls.password))}}function pt(i,n){i&1&&(o(0,"div",6)(1,"p",7),h(2,"Password: 00000"),s()())}function mt(i,n){if(i&1&&(o(0,"div",3)(1,"div",8),h(2,"Reservations Permissions"),s(),o(3,"div",6),d(4,"ks-base-checkbox",0),s(),o(5,"div",6),d(6,"ks-base-checkbox",0),s(),o(7,"div",6),d(8,"ks-base-checkbox",0),s(),o(9,"div",8),h(10,"Bungalows Permissions"),s(),o(11,"div",6),d(12,"ks-base-checkbox",0),s(),o(13,"div",6),d(14,"ks-base-checkbox",0),s(),o(15,"div",6),d(16,"ks-base-checkbox",0),s(),o(17,"div",8),h(18,"Customers Permissions"),s(),o(19,"div",6),d(20,"ks-base-checkbox",0),s(),o(21,"div",8),h(22,"Reports Permissions"),s(),o(23,"div",6),d(24,"ks-base-checkbox",0),s(),o(25,"div",8),h(26,"Reviews Permissions"),s(),o(27,"div",6),d(28,"ks-base-checkbox",0),s(),o(29,"div",8),h(30,"Expenses Permissions"),s(),o(31,"div",6),d(32,"ks-base-checkbox",0),s(),o(33,"div",6),d(34,"ks-base-checkbox",0),s(),o(35,"div",6),d(36,"ks-base-checkbox",0),s(),o(37,"div",6),d(38,"ks-base-checkbox",0),s(),o(39,"div",8),h(40,"Payments Permissions"),s(),o(41,"div",6),d(42,"ks-base-checkbox",0),s(),o(43,"div",6),d(44,"ks-base-checkbox",0),s(),o(45,"div",6),d(46,"ks-base-checkbox",0),s(),o(47,"div",8),h(48,"User Management"),s(),o(49,"div",6),d(50,"ks-base-checkbox",0),s(),o(51,"div",6),d(52,"ks-base-checkbox",0),s(),o(53,"div",6),d(54,"ks-base-checkbox",0),s(),o(55,"div",6),d(56,"ks-base-checkbox",0),s()()),i&2){let e=F();r(4),c("config",u(21,f,!e.canEdit,l(20,Oe),e.form.controls.permissions.controls.addReservation)),r(2),c("config",u(26,f,!e.canEdit,l(25,je),e.form.controls.permissions.controls.editReservation)),r(2),c("config",u(31,f,!e.canEdit,l(30,He),e.form.controls.permissions.controls.deleteReservation)),r(4),c("config",u(36,f,!e.canEdit,l(35,We),e.form.controls.permissions.controls.viewBungalow)),r(2),c("config",u(41,f,!e.canEdit,l(40,Ye),e.form.controls.permissions.controls.addBungalow)),r(2),c("config",u(46,f,!e.canEdit,l(45,qe),e.form.controls.permissions.controls.editBungalow)),r(4),c("config",u(51,f,!e.canEdit,l(50,ze),e.form.controls.permissions.controls.viewCustomers)),r(4),c("config",u(56,f,!e.canEdit,l(55,Ke),e.form.controls.permissions.controls.viewReports)),r(4),c("config",u(61,f,!e.canEdit,l(60,Je),e.form.controls.permissions.controls.viewReviews)),r(4),c("config",u(66,f,!e.canEdit,l(65,Qe),e.form.controls.permissions.controls.viewExpense)),r(2),c("config",u(71,f,!e.canEdit,l(70,Xe),e.form.controls.permissions.controls.addExpense)),r(2),c("config",u(76,f,!e.canEdit,l(75,Ze),e.form.controls.permissions.controls.editExpense)),r(2),c("config",u(81,f,!e.canEdit,l(80,et),e.form.controls.permissions.controls.deleteExpense)),r(4),c("config",u(86,f,!e.canEdit,l(85,tt),e.form.controls.permissions.controls.viewRevenue)),r(2),c("config",u(91,f,!e.canEdit,l(90,it),e.form.controls.permissions.controls.addRevenue)),r(2),c("config",u(96,f,!e.canEdit,l(95,nt),e.form.controls.permissions.controls.deleteRevenue)),r(4),c("config",u(101,f,!e.canEdit,l(100,ot),e.form.controls.permissions.controls.viewUser)),r(2),c("config",u(106,f,!e.canEdit,l(105,st),e.form.controls.permissions.controls.addUser)),r(2),c("config",u(111,f,!e.canEdit,l(110,rt),e.form.controls.permissions.controls.editUser)),r(2),c("config",u(116,f,!e.canEdit,l(115,at),e.form.controls.permissions.controls.viewLogs))}}var ye=(()=>{let n=class n{constructor(){this._sessionService=g(N),this._dialogRef=g(B),this.data=g(V),this.loggedInUser=this._sessionService.loggedInUser,this.canEdit=this.data&&this._sessionService.checkAccess(x.EDIT_USER)||this._sessionService.checkAccess(x.ADD_USER),this.cardConfig={header:{title:{text:this.canEdit?this.data?"Edit User":"Add User":"User",tag:"h3",fontWeight:"700"},position:"center",suffixButton:{label:{text:"Close"},matType:"mat-icon-button",prefixIcon:{icon:"icon_x_circle"},onClick:()=>this._closeDialog()}},content:{addClass:"card"},footer:{position:"center",buttons:[this.canEdit?{label:{text:"Save"},matType:"mat-flat-button",prefixIcon:{icon:"icon_save"},onClick:()=>{this._submit()}}:{label:{text:"Close"},matType:"mat-flat-button",onClick:()=>{this._dialogRef.close()}}]}},this.form=new O({username:new m("",[S.required,S.minLength(4),S.maxLength(20)]),name:new m("",[S.required,S.minLength(4),S.maxLength(20)]),password:new m(!1),admin:new m(!1),active:new m(!1),passwordRetries:new m(0),permissions:new O({viewCustomers:new m(!1),viewReviews:new m(!1),viewLogs:new m(!1),viewReports:new m(!1),viewUser:new m(!1),addUser:new m(!1),editUser:new m(!1),deleteUser:new m(!1),viewRevenue:new m(!1),addRevenue:new m(!1),deleteRevenue:new m(!1),viewExpense:new m(!1),addExpense:new m(!1),editExpense:new m(!1),deleteExpense:new m(!1),viewBungalow:new m(!1),addBungalow:new m(!1),editBungalow:new m(!1),deleteBungalow:new m(!1),addReservation:new m(!1),editReservation:new m(!1),deleteReservation:new m(!1)})})}ngOnInit(){this.data&&this._editForm(this.data)}_closeDialog(t){this._dialogRef.close(t)}_submit(){he(this.form)&&this._closeDialog(this._format(this.form.value))}_editForm(t){this.form.patchValue({username:t.username,name:t.name,admin:t.admin,active:t.active,passwordRetries:t.passwordRetries,permissions:t.permissions})}_format(t){let a={username:t.username,name:t.name,admin:!!t.admin,active:!!t.active,permissions:t.permissions,passwordRetries:t.active?0:t.passwordRetries};return(t.password||!this.data)&&(a.password="00000"),t.admin&&(a.permissions={}),a}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=k({type:n,selectors:[["ks-solutions-user-popup"]],standalone:!0,features:[U],decls:12,vars:22,consts:[[3,"config"],[1,"py-2",3,"formGroup"],[1,"container-fluid",2,"max-height","calc(100dvh - 220px)"],[1,"row"],[1,"col-12","col-lg-6",3,"config"],[1,"text-center","h4"],[1,"col-12","col-md-6","col-lg-4"],[1,"mt-2","ps-3","h5","mb-0"],[1,"col-12","h4","mt-4","mb-0"]],template:function(a,p){a&1&&(o(0,"ks-base-card",0)(1,"form",1)(2,"div",2)(3,"div",3),d(4,"ks-base-input",4)(5,"ks-base-input",4),s(),C(6,ct,2,0,"div",5),o(7,"div",3),C(8,lt,4,12)(9,dt,2,6,"div",6)(10,pt,3,0,"div",6),s(),C(11,mt,57,120,"div",3),s()()()),a&2&&(c("config",p.cardConfig),r(),c("formGroup",p.form),r(3),c("config",G(10,Me,l(8,Pe),p.form.controls.username,p.canEdit?!!p.data:!0,l(9,Te))),r(),c("config",G(17,Ve,l(15,Le),p.form.controls.name,l(16,Be),!p.canEdit)),r(),b(p.data&&p.form.value.username===(p.loggedInUser==null?null:p.loggedInUser.username)?6:-1),r(2),b(p.form.value.username!==(p.loggedInUser==null?null:p.loggedInUser.username)?8:-1),r(),b(p.data&&p.form.value.username!==(p.loggedInUser==null?null:p.loggedInUser.username)?9:p.data?-1:10),r(2),b(p.form.value.admin?-1:11))},dependencies:[$,ve,xe,re,oe,ne,se],changeDetection:0});let i=n;return i})();var H=(()=>{let n=class n{constructor(){this._networkService=g(fe),this._users$=new L,this.users$=this._users$.asObservable()}getAllUsers(){this._networkService.get(R.USERS.users).subscribe({next:t=>{this._users$.next(t.data?t.data:[])}})}addNewUser(t){this._networkService.post(R.USERS.users,t).pipe(v(1)).subscribe({next:()=>{this.getAllUsers()}})}getLogs(t){return this._networkService.get(R.USERS.tracking,t.username)}editUser(t){this._networkService.patch(R.USERS.users,t,t.username).pipe(v(1)).subscribe({next:()=>{this.getAllUsers()}})}deleteUser(t){this._networkService.delete(R.USERS.users,void 0,t.username).pipe(v(1)).subscribe({next:()=>{this.getAllUsers()}})}};n.\u0275fac=function(a){return new(a||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac});let i=n;return i})();function ut(i,n){if(i&1&&d(0,"ks-basic-grid",0),i&2){let e=F();c("config",e.gridConfig)("refresh$",e.refresh$)}}var Xt=(()=>{let n=class n{constructor(){this._destroyRef=g(Z),this._dialog=g(ue),this._userService=g(H),this._navService=g(be),this._configService=g(Se),this._sessionService=g(N),this._loggedInUser=this._sessionService.loggedInUser,this._isAdmin=this._sessionService.checkAccess(x.ADMIN),this._canAdd=this._sessionService.checkAccess(x.ADD_USER),this._canEdit=this._sessionService.checkAccess(x.EDIT_USER),this._canViewLogs=this._sessionService.checkAccess(x.VIEW_LOGS),this.refresh$=new L}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:we.LAYOUT.children.USER_MANAGEMENT.name,buttons:[{label:{text:"Add User"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._canAdd,onClick:()=>this._openUserPopup()}]}),this._initializeGrid(),this._userService.getAllUsers()}ngAfterViewInit(){this._userService.users$.pipe(ae(this._destroyRef)).subscribe(t=>{this.refresh$.next({data:t})})}_initializeGrid(){this.gridConfig={data:ee([]),defaultPagination:100,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearch,noDataMessage:{text:"No Users Found"},features:{showSearch:!0},columns:[{field:"username",title:"Username",type:"string",extraStyles:{"min-width":"150px"}},{field:"name",title:"Name",type:"string",extraStyles:{"min-width":"150px"}},{field:"admin",title:"Admin",type:"chip",extraStyles:{"max-width":"120px",width:"120px"},truthy:{false:"No",true:"Yes"},setChipClass:t=>t.admin===!0?"rounded rounded-5 px-3 py-1 text-bg-success":"rounded rounded-5 px-3 py-1 text-bg-danger"},{field:"active",title:"Active",type:"chip",extraStyles:{"max-width":"120px",width:"120px"},truthy:{false:"No",true:"Yes"},setChipClass:t=>t.active===!0?"rounded rounded-5 px-3 py-1 text-bg-success":"rounded rounded-5 px-3 py-1 text-bg-danger"}],actionsColumn:Q(J({},this._configService.getActionColumn(3)),{enabled:this._canEdit||this._canViewLogs||this._isAdmin,buttons:[{prefixIcon:{icon:"icon_clock_alt"},label:{text:"View Logins"},onClickFn:t=>this._openLogsPopup(t),isVisibleFn:()=>this._canViewLogs,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:t=>this._openUserPopup(t),isVisibleFn:()=>this._canEdit,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete"},color:"warn",label:{text:"Delete"},onClickFn:t=>this._deleteUser(t),isVisibleFn:t=>!!(t.username!==this._loggedInUser?.username&&this._isAdmin),matType:"mat-icon-button"}]})}}_openUserPopup(t){this._dialog.open(ye,{width:"95vw",maxWidth:"1000px",maxHeight:"95vh",disableClose:!0,autoFocus:!1,restoreFocus:!0,data:t}).afterClosed().pipe(v(1)).subscribe(a=>{a&&t?this._userService.editUser(a):a&&!t&&this._userService.addNewUser(a)})}_openLogsPopup(t){this._userService.getLogs(t).pipe(v(1)).subscribe(a=>{a&&a.data&&this._dialog.open(Ee,{width:"95vw",maxWidth:"500px",maxHeight:"95vh",disableClose:!0,autoFocus:!1,restoreFocus:!0,data:{user:t,dates:a.data.map(p=>p.date)}})})}_deleteUser(t){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this user?"}}).afterClosed().pipe(v(1)).subscribe(a=>{a&&t?.username&&this._userService.deleteUser(t)})}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=k({type:n,selectors:[["ks-solutions-users-listing"]],standalone:!0,features:[ie([H]),U],decls:1,vars:1,consts:[[3,"config","refresh$"]],template:function(a,p){a&1&&C(0,ut,1,2,"ks-basic-grid",0),a&2&&b(p.gridConfig?0:-1)},dependencies:[_e],changeDetection:0});let i=n;return i})();export{Xt as UsersComponent};
