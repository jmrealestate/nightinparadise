import{a as I}from"./chunk-RKWG6QH3.js";import{a as B}from"./chunk-CXG5DA6O.js";import"./chunk-JHOHYJWD.js";import{a}from"./chunk-JE5EXO4F.js";import{b as F}from"./chunk-JWZPFOXC.js";import{a as T}from"./chunk-Q7PONYZL.js";import"./chunk-6CYPE36V.js";import"./chunk-BPNGRFUY.js";import{a as P}from"./chunk-ONICS2XY.js";import{a as N}from"./chunk-5ML3MIDN.js";import{Ba as k,Ca as M,Y as w,ja as A}from"./chunk-32GEDFAZ.js";import{Cb as p,Da as x,Ib as S,L as c,Nb as g,Ob as y,Pb as v,Wb as E,Yb as b,a as o,b as h,fb as _,ia as s,m as l,ma as m,pc as C,qb as f,rc as D,xb as u}from"./chunk-OWBIYIKH.js";var L=i=>({date:i,format:"MMMM yyyy"});function R(i,r){if(i&1&&v(0,"ks-basic-grid",1),i&2){let d=b();p("config",d.gridConfig)("refresh$",d.refresh$)}}var ee=(()=>{let r=class r{constructor(){this._destroyRef=s(x),this._dialog=s(A),this._navService=s(P),this._sharedService=s(B),this._configService=s(T),this._sessionService=s(F),this._expensesService=s(I),this.date=this._expensesService.date,this.refresh$=new l,this._isAdmin=this._sessionService.checkAccess(a.ADMIN),this._canAdd=this._sessionService.checkAccess(a.ADD_EXPENSE),this._canEdit=this._sessionService.checkAccess(a.EDIT_EXPENSE),this._canDelete=this._sessionService.checkAccess(a.DELETE_EXPENSE)}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:N.LAYOUT.children.EXPENSES.name,buttons:[{label:{text:"Change Month"},prefixIcon:{icon:"icon_calendar"},onClick:()=>this._openSearchByDate()},{label:{text:"Add Expense"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._canAdd,onClick:()=>this._openExpensePopup()}]}),this._expensesService.date.set(new Date),this._initializeGrid(),this._expensesService.getExpenses()}ngAfterViewInit(){this._expensesService.filteredExpenses$.pipe(w(this._destroyRef)).subscribe(e=>{this.refresh$.next({data:e})})}changeDate(e){this._expensesService.changeDate(e)}_openSearchByDate(){this._sharedService.openSearchByDate().pipe(c(1)).subscribe(e=>e&&this._expensesService.changeDate(e))}_initializeGrid(){this.gridConfig={data:f([]),defaultPagination:100,maxTableHeight:this._configService.appConfig.maxTableHeightWithSearchAndChanger,noDataMessage:{text:"No Expenses Found"},features:{showSearch:!0},columns:[{field:"name",title:"Expense",type:"string",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"}},{field:"amount",title:"Amount",type:"number",extraStyles:{"min-width":"100px","max-width":"100px",width:"100px"}},{field:"notes",title:"Notes",type:"string",extraStyles:{"max-width":"300px","min-width":"150px"}},{field:"date",title:"Date",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"110px","max-width":"110px",width:"110px"}},{field:"createdBy",title:"Created By",type:"string",extraStyles:{"min-width":"120px","max-width":"120px",width:"120px"},hide:!this._isAdmin},{field:"createdAt",title:"Created At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"},hide:!this._isAdmin}],actionsColumn:h(o({},this._configService.getActionColumn(2)),{enabled:this._canEdit||this._canDelete,buttons:[{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:e=>this._openExpensePopup(e),matType:"mat-icon-button",isVisibleFn:()=>this._canEdit},{prefixIcon:{icon:"icon_delete"},color:"warn",label:{text:"Delete"},onClickFn:e=>this._deleteExpense(e),matType:"mat-icon-button",isVisibleFn:()=>this._canDelete}]})}}_openExpensePopup(e){let n={hideClearButton:!0,title:{text:e?"Edit Expense":"Add Expense"},form:{value:e||{date:this._sharedService.getUtcDate()},fields:[{name:"name",maxLength:30,required:!0,flexibleValue:!0,type:"autocomplete",label:{text:"Expense"},stream:this._expensesService.expensesLov$,transformer:{nameKey:"name",valueKey:"value"}},{name:"amount",type:"number",label:{text:"Amount in $"},required:!0,range:{max:1e5}},{name:"date",type:"date",label:{text:"Date"},required:!0},{name:"notes",type:"text",label:{text:"Notes"},maxLength:100}]},beforeCloseObservable:t=>(t.date=this._sharedService.getUtcDate(t.date),e?this._expensesService.updateExpense(o(o({},e),t)):this._expensesService.addExpense(t)),getAfterSuccessResponse:t=>{t.data&&this._expensesService._updateStream(t.data,e?"edit":"add")}};this._dialog.openFormPopup(n,"500px")}_deleteExpense(e){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this expense?"}}).afterClosed().pipe(c(1)).subscribe(n=>{n&&e?._id&&this._expensesService.deleteExpense(e)})}};r.\u0275fac=function(n){return new(n||r)},r.\u0275cmp=m({type:r,selectors:[["ks-solutions-expenses"]],standalone:!0,features:[C],decls:2,vars:4,consts:[[3,"btnClicked","config"],[3,"config","refresh$"]],template:function(n,t){n&1&&(g(0,"ks-base-changer",0),E("btnClicked",function($){return t.changeDate($)}),y(),u(1,R,1,2,"ks-basic-grid",1)),n&2&&(p("config",D(2,L,t.date)),_(),S(t.gridConfig?1:-1))},dependencies:[k,M],changeDetection:0});let i=r;return i})();export{ee as ExpensesComponent};
