import{a as ce,b as be}from"./chunk-MJMRWT4J.js";import{a as u,b as Pe}from"./chunk-AXDSQ2ON.js";import{a as se,b as Ue,c as f,d as P}from"./chunk-VAAUDI2H.js";import{a as R,b as pe}from"./chunk-UOQFKZ5Q.js";import{a as ae,b as ye}from"./chunk-I6XSNUQR.js";import{a as o,b}from"./chunk-DKBVEZ2J.js";import{Aa as re,Ca as O,Da as T,Pa as ie,Sa as v,b as j,ba as ne,ca as Le,d as z,e as X,f as Z,g as $,i as Ie,j as J,k as Q,l as q,m as ee,o as te,p as d,q as oe,r as A,ya as C}from"./chunk-P2MZAAVA.js";import{Fb as B,Gb as V,I as M,J as k,M as I,Q as Y,Qb as y,Rb as K,Sb as U,Vc as l,aa as w,ba as D,e as c,f as ke,h as N,ib as L,la as r,pa as G,sc as W,tb as H,uc as F,v as S}from"./chunk-LUSYJMV7.js";var xe,me,le=c(()=>{"use strict";l();A();v();ye();P();l();xe=e=>({loading:e,disableInteractions:!0}),me=(()=>{let t=class t{constructor(){this._router=r(d),this._navService=r(ae),this._sessionService=r(f),this._keyBlocked=!1,this.loadingRouteSig=H(!1)}ngOnInit(){this._sessionService.updateUser(),this._navService.getThemeOnLoad(),document.addEventListener("keydown",n=>{if(["Enter"," "].includes(n.key)){if(this._keyBlocked){n.preventDefault(),n.stopPropagation();return}this._keyBlocked=!0,setTimeout(()=>{this._keyBlocked=!1},300)}}),this._router.events.subscribe(n=>{n instanceof J?(this.loadingRouteSig.set(!0),window.scrollTo(0,0)):(n instanceof Q||n instanceof ee||n instanceof q)&&this.loadingRouteSig.set(!1)})}};t.\u0275fac=function(s){return new(s||t)},t.\u0275cmp=G({type:t,selectors:[["app-root"]],standalone:!0,features:[W],decls:4,vars:5,consts:[[1,"app-container"],[3,"config"],[1,"global-router-container"]],template:function(s,i){s&1&&(y(0,"div",0),U(1,"ks-loader-overlay",1),y(2,"div",2),U(3,"router-outlet"),K()()),s&2&&(L(),B("config",F(3,xe,i.loadingRouteSig)),L(),V("display",i.loadingRouteSig()?"none":"block"))},dependencies:[te,ie],styles:[".app-container[_ngcontent-%COMP%], .app-container[_ngcontent-%COMP%]   .global-router-container[_ngcontent-%COMP%]{min-height:100dvh}"],changeDetection:0});let e=t;return e})()});var m,ue=c(()=>{"use strict";l();A();b();P();m=e=>{let t=r(d),p=r(f);if(!p.loggedInUser)return t.navigate([o.LOGIN.route]),!1;if(!e.data)return!0;let s=e.data.roles;if(!s||!Array.isArray(s)||s.length===0)return!0;let i=p.checkAccess(s);return!i&&t.navigate([o.NOT_AUTHORIZED.route]),i}});var de,fe=c(()=>{"use strict";l();A();b();P();de=()=>{let e=r(d);return r(f).loggedInUser?(e.navigate([o.LAYOUT.route]),!1):!0}});var Me,he,ge=c(()=>{"use strict";b();ue();fe();Pe();Me=[{path:"",redirectTo:o.LAYOUT.children.RESERVATIONS.endpoint,pathMatch:"full"},{path:o.LAYOUT.children.CUSTOMERS.endpoint,loadComponent:()=>import("./chunk-R2HDJP7B.js").then(e=>e.CustomersComponent),canActivate:[m]},{path:o.LAYOUT.children.RESERVATIONS.endpoint,loadComponent:()=>import("./chunk-YPTI6QII.js").then(e=>e.ReservationsComponent),canActivate:[m]},{path:o.LAYOUT.children.BUNGALOWS.endpoint,loadComponent:()=>import("./chunk-26EN5FTH.js").then(e=>e.BungalowsComponent),canActivate:[m],data:{roles:[u.VIEW_BUNGALOW]}},{path:o.LAYOUT.children.REVIEWS.endpoint,loadComponent:()=>import("./chunk-KQ2VZCDH.js").then(e=>e.ReviewsComponent),canActivate:[m],data:{roles:[u.VIEW_REVIEWS]}},{path:o.LAYOUT.children.REVENUES.endpoint,loadComponent:()=>import("./chunk-76NWWYML.js").then(e=>e.RevenuesComponent),canActivate:[m],data:{roles:[u.VIEW_REVENUE]}},{path:o.LAYOUT.children.EXPENSES.endpoint,loadComponent:()=>import("./chunk-4ABXCJPV.js").then(e=>e.ExpensesComponent),canActivate:[m],data:{roles:[u.VIEW_EXPENSE]}},{path:o.LAYOUT.children.USER_MANAGEMENT.endpoint,loadComponent:()=>import("./chunk-JNFU32NV.js").then(e=>e.UsersComponent),canActivate:[m],data:{roles:[u.VIEW_USER]}},{path:o.LAYOUT.children.REPORTS.endpoint,loadComponent:()=>import("./chunk-IMCLCQ7D.js").then(e=>e.ReportsComponent),canActivate:[m],data:{roles:[u.VIEW_REPORTS]},children:[{path:"",pathMatch:"full",redirectTo:o.LAYOUT.children.REPORTS.children.YEARLY.endpoint},{path:o.LAYOUT.children.REPORTS.children.YEARLY.endpoint,loadComponent:()=>import("./chunk-J4E5DY5K.js").then(e=>e.ReportByYearComponent)}]}],he=[{path:"",redirectTo:o.HOME.endpoint,pathMatch:"full"},{path:o.HOME.endpoint,loadComponent:()=>import("./chunk-2MJEJZ3G.js").then(e=>e.MainPageComponent)},{path:o.LAYOUT.endpoint,loadComponent:()=>import("./chunk-HMOHRTCM.js").then(e=>e.LayoutComponent),children:Me,canActivate:[m]},{path:o.LOGIN.endpoint,loadComponent:()=>import("./chunk-ZDGOKWOX.js").then(e=>e.LoginComponent),canActivate:[de]},{path:o.NOT_AUTHORIZED.endpoint,loadComponent:()=>import("./chunk-XVMHFGL6.js").then(e=>e.NotAuthorizedComponent)},{path:o.PAGE_NOT_FOUND.endpoint,loadComponent:()=>import("./chunk-GZVFWTZW.js").then(e=>e.PageNotFoundComponent)},{path:"**",redirectTo:o.PAGE_NOT_FOUND.endpoint,pathMatch:"full"}]});var h,_=c(()=>{"use strict";pe();h={API_HOST:R.API_HOST.nip_prod,CONFIG_URL:"assets/config/nip.json"}});function E(e,t){return e.clone({setHeaders:{Authorization:"Bearer "+t.getItem(se.SS.token,!0)},withCredentials:!0})}var x=c(()=>{"use strict";Ue()});var Se,ve=c(()=>{"use strict";l();v();D();x();_();pe();be();Se=(e,t)=>{let p=r(C),n=r(ce),s=r(T),i=r(O),g;return t(e).pipe(Y(()=>{if(g){let a=g;a.showMessage&&a.message&&(a.isDialog?p.openConfirmPopup({hideYesNo:!0,message:{text:a.message,translate:!1},title:{text:a.title??"Error",translate:!1}}):s.open({text:a.message,translate:!1},a.state??"error",{duration:a.snackbarDuration}))}}),M(a=>(g=a.error,a.status===401?e.url===h.API_HOST+R.AUTHENTICATION.refresh?(n.logOut(!0),S(()=>a)):n.isRefreshTokenCalled!==!0?(n.isRefreshTokenCalled=!0,n.callRefreshToken().pipe(I(1),k(Ne=>(n.successfulRefreshToken(Ne),t(E(e,i)))))):n.refreshToken$.pipe(I(1),k(()=>t(E(e,i)))):a.status===403?(n.isLogoutCalled||(p.closeAll(),p.openConfirmPopup({message:{text:"You don't have permission to access this resource."},title:{text:"Error"},hideYesNo:!0})),n.logOut(!0),S(()=>a)):a.status===0?(p.openConfirmPopup({message:[{tag:"span",text:"Please check your internet connection and ensure it is stable.",addClass:"fw-bold"},{tag:"span",text:"If the issue persists, please contact your administrator for further assistance."}],title:{text:"Something went wrong"},hideYesNo:!0}),S(()=>a)):S(()=>a))))}});var Ee,Ae=c(()=>{"use strict";Z();l();v();D();Ee=(e,t)=>{let p=r(C),n=r(T);return t(e).pipe(w(s=>{if(s instanceof j&&s.body){let i=s.body;if(i.showMessage&&i.message)if(i.isDialog){let g={hideYesNo:!0,message:{text:i.message,translate:!1},title:{text:i.title??"Message",translate:!1}};p.openConfirmPopup(g)}else n.open({text:i.message,translate:!1},i.state??"success",{duration:i.snackbarDuration})}}))}});var Ce,Oe=c(()=>{"use strict";l();v();x();Ce=(e,t)=>{let p=r(O);return t(E(e,p))}});var Te,Re=c(()=>{"use strict";Z();Le();A();v();ge();_();ve();Ae();Oe();Te={providers:[oe(he),ne(),z(X([Ce,Se,Ee])),re({iconSize:"md",locale:"en-GB",forceLocal:!0,defaultLang:"en",snackbarDuration:3e3,defaultLoaderType:"dots",defaultMaximumNumberLength:15,enableTranslationByDefault:!0,defaultMaximumAfterCommaLength:2,snackbarDefaultPositionY:"bottom",defaultDisableNegativeNumbers:!0,baseNetworkServiceUrl:h.API_HOST,storageSecretKey:"my_night_in_paradise_secret_Key"})]}});var we=ke(_e=>{Ie();le();Re();_();N(_e,null,function*(){yield Ye(),$(me,Te).catch(e=>console.error(e))});function Ye(){return N(this,null,function*(){let e;try{let t=yield fetch(h.CONFIG_URL);if(!t.ok)throw new Error(`Failed to fetch config: ${t.statusText}`);e=yield t.json()}catch{e={appName:"BMS",version:"3.0.0",mainPageLogoUrl:"",snackbarDuration:5e3,appOwner:"KS Solutions",mainPageTitle:"Managed by KS Solutions",ownerEmail:"ks_solutions_lb@hotmail.com",appOwnerLink:"https://ks-solutions-lb.com/",maxTableHeightWithSearch:"calc(100dvh - 115px - 50px - 50px - 90px)"}}localStorage.setItem("config",JSON.stringify(e))})}});export default we();
