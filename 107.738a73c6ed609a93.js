"use strict";(self.webpackChunkpos=self.webpackChunkpos||[]).push([[107],{1326:(A,E,o)=>{o.r(E),o.d(E,{WholesaleCustomerModule:()=>Q});var e=o(177),C=o(7062),g=o(5351),d=o(2646),t=o(7705),a=o(4848),m=o(206),f=o(9879);const D=function(){return{"box-shadow":"var(--opened-invoice-shadow)"}},R=function(i){return{extraClass:"w-100 h-100 cs-bg-blue p-3",extraStyles:i}},b=function(){return{icon:"contact_phone",ripple:!0}},$=function(){return{icon:"calendar_today",ripple:!0}},T=function(){return{icon:"monetization_on",ripple:!0}};function I(i,y){if(1&i&&(t.j41(0,"div",5)(1,"shared-card",6)(2,"div",7),t.nrm(3,"shared-icon",8),t.j41(4,"span",9),t.EFF(5),t.k0s()(),t.j41(6,"div",10),t.nrm(7,"shared-icon",8),t.j41(8,"span",9),t.EFF(9),t.k0s()(),t.j41(10,"div",7),t.nrm(11,"shared-icon",8),t.j41(12,"span",9),t.EFF(13),t.k0s()()()()),2&i){const n=y.$implicit,s=t.XpG(2);t.R7$(1),t.Y8G("config",t.eq3(8,R,t.lJ4(7,D))),t.R7$(2),t.Y8G("config",t.lJ4(10,b)),t.R7$(2),t.JRh(n.contact),t.R7$(2),t.Y8G("config",t.lJ4(11,$)),t.R7$(2),t.JRh(s.changeDate(n.bookedDate)),t.R7$(2),t.Y8G("config",t.lJ4(12,T)),t.R7$(2),t.JRh(n.price)}}function M(i,y){if(1&i&&(t.j41(0,"div",2)(1,"div",3),t.DNE(2,I,14,13,"div",4),t.k0s()()),2&i){const n=t.XpG();t.R7$(2),t.Y8G("ngForOf",n.data.bookings)}}const F=function(){return{title:"Customer's Reservations"}};let S=(()=>{class i{constructor(n,s){this.data=n,this._dialogRef=s}handleDialogActions(n){(!n||"ok"===n||"cancel"===n)&&this.closeDialog()}changeDate(n){return(0,d.n)(n)}closeDialog(){this._dialogRef.close()}static#e=this.\u0275fac=function(s){return new(s||i)(t.rXU(g.Vh),t.rXU(g.CP))};static#t=this.\u0275cmp=t.VBU({type:i,selectors:[["app-customer-popup"]],decls:2,vars:3,consts:[[3,"config","btnClicked"],["class","container py-2 cd-max",4,"ngIf"],[1,"container","py-2","cd-max"],[1,"row","justify-content-center","my-auto"],["class","cs-card",4,"ngFor","ngForOf"],[1,"cs-card"],[1,"active",3,"config"],[1,"d-flex","align-items-center","gap-2"],[1,"cursor-pointer",3,"config"],[1,"text-break"],[1,"d-flex","align-items-center","gap-2","my-1"]],template:function(s,u){1&s&&(t.j41(0,"shared-confirm-body",0),t.bIt("btnClicked",function(h){return u.handleDialogActions(h)}),t.DNE(1,M,3,1,"div",1),t.k0s()),2&s&&(t.Y8G("config",t.lJ4(2,F)),t.R7$(1),t.Y8G("ngIf",u.data&&u.data.bookings))},dependencies:[e.Sq,e.bT,a.R,m.i,f.m],styles:[".cd-max[_ngcontent-%COMP%]{max-height:calc(90vh - 150px);overflow-y:scroll}.cs-card[_ngcontent-%COMP%]{width:250px;margin-bottom:20px;font-size:16px;font-weight:700;cursor:pointer;position:relative}.active[_ngcontent-%COMP%]{background-color:var(--primary-color)}"]})}return i})();var c=o(6977),_=o(6697),r=o(6933);const p=function(){return{icon:"info",ripple:!0}};let l=(()=>{class i{constructor(n){this._customerService=n}agInit(n){this.cellValue=this.getValueToDisplay(n)}refresh(n){return this.cellValue=this.getValueToDisplay(n),!0}onInfo(){this._customerService.changes$.next({action:"view-details",customer:this.rowValue})}getValueToDisplay(n){return this.rowValue=n.data,n.valueFormatted?n.valueFormatted:n.value}static#e=this.\u0275fac=function(s){return new(s||i)(t.rXU(d.s))};static#t=this.\u0275cmp=t.VBU({type:i,selectors:[["total-value-component"]],decls:2,vars:2,consts:[[1,"h-100","w-100","d-flex","align-items-center","justify-content-center"],[1,"cursor-pointer",3,"config","click"]],template:function(s,u){1&s&&(t.j41(0,"div",0)(1,"shared-icon",1),t.bIt("click",function(){return u.onInfo()}),t.k0s()()),2&s&&(t.R7$(1),t.Y8G("config",t.lJ4(1,p)))},dependencies:[a.R],styles:["button[_ngcontent-%COMP%]{border:none;background-color:inherit}"]})}return i})();var k=o(9417),G=o(8103),W=o(1335),P=o(6834),x=o(2288),N=o(5572),Y=o(8895),w=o(3524),B=o(6983);const L=function(){return{icon:"search",color:"var(--primary-color)"}},V=function(i){return{label:"Search",prefixIcon:i}};var O=function(i){return i.downloadExcel="Download Excel",i}(O||{});const U=[{path:"",component:(()=>{class i extends W.${constructor(n,s,u){super(s),this._dialog=n,this._navService=s,this._LocalCustomersService=u,this.buttons=[],this.isAdmin=(0,r.o)(G.m.admin),this.innerWidth=window.innerWidth,this.searchControl=new k.MJ(""),this.columnDefs=this.getCols(),this.defaultColDef={initialWidth:100,sortable:!0,resizable:!0,filter:!0,flex:1,minWidth:100}}ngOnInit(){this._LocalCustomersService.getAllCustomersNames(),this.isAdmin&&this.buttons.push({label:O.downloadExcel,prefixIcon:{icon:"library_books"}}),this.Navbar_Update({show:!0,back:!1,title:this.NAV_NAMES.CUSTOMERS_MANAGEMENT.children.WHOLESALE.name,buttons:this.buttons}),this.NavButtons$.pipe((0,c.Q)(this.__unsubscribe$)).subscribe(n=>{n===O.downloadExcel&&this.downloadExcel()}),this.searchControl.valueChanges.pipe((0,c.Q)(this.__unsubscribe$)).subscribe(n=>{this.onFilterTextBoxChanged(n)}),this._LocalCustomersService.changes$.pipe((0,c.Q)(this.__unsubscribe$)).subscribe(n=>{"view-details"===n.action&&this.openCustomerReservations(n.customer)})}ngOnDestroy(){super.ngOnDestroy(),this._LocalCustomersService.changes$.next({})}onGridReady(n){this.gridApi=n.api,this._LocalCustomersService.customers$.pipe((0,c.Q)(this.__unsubscribe$)).subscribe(s=>this.rowData=s)}onFilterTextBoxChanged(n){this.gridApi.setQuickFilter(n)}openCustomerReservations(n){this._dialog.open(S,{width:"95vw",maxWidth:"600px",maxHeight:"95vh",disableClose:!0,restoreFocus:!1,data:n})}downloadExcel(){this._LocalCustomersService.customers$.pipe((0,_.s)(1)).subscribe(n=>{this._dialog.open(N.B,{width:"95vw",maxWidth:"300px",maxHeight:"95vh",disableClose:!0,restoreFocus:!1}).afterClosed().pipe((0,_.s)(1)).subscribe(s=>{if(s&&s.year){const u=[];n.forEach(v=>{if(v.bookings.some(h=>new Date(h.bookedDate).getFullYear()===s.year)){const h={count:0,bookings:[],name:v.name};h.bookings=v.bookings.filter(Z=>new Date(Z.bookedDate).getFullYear()===s.year),h.count=h.bookings.length,console.log(h),u.push(h)}}),function j(i){if(!i&&!Array.isArray(i))return;const y=(0,P.pA)(new Date),n=[];i.forEach(v=>{v.bookings.forEach(h=>{n.push({"Customer Name":v.name,"Nb Of Reservations":v.count,"Contact Info":h.contact,"Reservation Date":(0,d.n)(h.bookedDate),"Reservation Price":h.price})})});const s=x.Wp.json_to_sheet(n);s["!cols"]=[{width:50},{width:20},{width:30},{width:20},{width:20}];const u=x.Wp.book_new();x.Wp.book_append_sheet(u,s,"Details"),(0,x._h)(u,`Customers_At_${y.replaceAll(" ","_")}.xlsx`)}(u)}})})}getCols(){return[{headerName:"Name",field:"name",minWidth:150},{headerName:"Reservations",field:"count",width:150,minWidth:150,maxWidth:150},{headerName:"",cellRenderer:l,width:60,minWidth:60,maxWidth:60,sortable:!1,filter:!1,resizable:!1,pinned:"right"}]}onWindowResize(n){this.innerWidth=window.innerWidth}static#e=this.\u0275fac=function(s){return new(s||i)(t.rXU(g.bZ),t.rXU(Y.F),t.rXU(d.s))};static#t=this.\u0275cmp=t.VBU({type:i,selectors:[["app-wholesale-customer"]],hostBindings:function(s,u){1&s&&t.bIt("resize",function(){return u.onWindowResize()},!1,t.tSv)},features:[t.Vt3],decls:3,vars:15,consts:[[2,"max-width","300px"],[3,"config","control"],[2,"width","100%","height","calc(100vh - 255px)","min-height","400px",3,"rowHeight","columnDefs","defaultColDef","rowData","pagination","paginationAutoPageSize","gridReady"]],template:function(s,u){1&s&&(t.j41(0,"div",0),t.nrm(1,"shared-input",1),t.k0s(),t.j41(2,"ag-grid-angular",2),t.bIt("gridReady",function(h){return u.onGridReady(h)}),t.k0s()),2&s&&(t.R7$(1),t.Y8G("config",t.eq3(13,V,t.lJ4(12,L)))("control",u.searchControl),t.R7$(1),t.AVh("ag-theme-alpine","light"===u.$theme)("ag-theme-alpine-dark","dark"===u.$theme),t.Y8G("rowHeight",35)("columnDefs",u.columnDefs)("defaultColDef",u.defaultColDef)("rowData",u.rowData)("pagination",u.innerWidth>700)("paginationAutoPageSize",!0))},dependencies:[w.xs,B.S]})}return i})()}];let J=(()=>{class i{static#e=this.\u0275fac=function(s){return new(s||i)};static#t=this.\u0275mod=t.$C({type:i});static#n=this.\u0275inj=t.G2t({imports:[C.iI.forChild(U),C.iI]})}return i})();var X=o(2422),z=o(9334),H=o(5526),K=o(9182);let Q=(()=>{class i{static#e=this.\u0275fac=function(s){return new(s||i)};static#t=this.\u0275mod=t.$C({type:i});static#n=this.\u0275inj=t.G2t({imports:[e.MD,w.$V,J,X.m,g.hM,z.H,H.V,K.O]})}return i})()},7038:(A,E,o)=>{o.d(E,{w:()=>S});var e=o(7705),C=o(9417),g=o(177),d=o(882),t=o(2798),a=o(6600),m=o(4848),f=o(231);function D(c,_){if(1&c){const r=e.RV6();e.j41(0,"shared-icon",8),e.bIt("click",function(){e.eBV(r);const l=e.XpG();return e.Njj(l.onIconClick("prefix"))}),e.k0s()}if(2&c){const r=e.XpG();e.Y8G("config",r.config.prefixIcon)}}function R(c,_){if(1&c&&(e.j41(0,"span",10),e.EFF(1),e.k0s()),2&c){const r=e.XpG(2);e.R7$(1),e.Lme(" (+",((null==r.control.value?null:r.control.value.length)||0)-1," ",2===(null==r.control.value?null:r.control.value.length)?"other":"others",") ")}}function b(c,_){if(1&c&&(e.j41(0,"mat-select-trigger"),e.EFF(1),e.DNE(2,R,2,2,"span",9),e.k0s()),2&c){const r=e.XpG();e.R7$(1),e.SpI(" ",r.onChange()," "),e.R7$(1),e.Y8G("ngIf",((null==r.control.value?null:r.control.value.length)||0)>1)}}function $(c,_){if(1&c&&(e.j41(0,"mat-select-trigger"),e.EFF(1),e.k0s()),2&c){const r=e.XpG();e.R7$(1),e.SpI(" ",r.onChange()," ")}}function T(c,_){if(1&c&&(e.j41(0,"mat-option",11),e.EFF(1),e.k0s()),2&c){const r=e.XpG();e.xc7("border-bottom","1px solid var(--divider-color)"),e.Y8G("value",void 0),e.R7$(1),e.SpI(" ",r.config.emptyOption," ")}}function I(c,_){if(1&c&&(e.j41(0,"mat-option",11),e.EFF(1),e.k0s()),2&c){const r=_.$implicit;e.xc7("border-bottom","1px solid var(--divider-color)"),e.Y8G("value",r.value),e.R7$(1),e.SpI(" ",r.name," ")}}function M(c,_){if(1&c){const r=e.RV6();e.j41(0,"shared-icon",12),e.bIt("click",function(){e.eBV(r);const l=e.XpG();return e.Njj(l.onIconClick("suffix"))}),e.k0s()}if(2&c){const r=e.XpG();e.Y8G("config",r.config.suffixIcon)}}function F(c,_){if(1&c&&(e.j41(0,"mat-error"),e.nrm(1,"shared-field-validation",13),e.k0s()),2&c){const r=e.XpG();e.R7$(1),e.Y8G("control",r.control)}}let S=(()=>{class c{constructor(){this.control=new C.MJ,this.iconClickEvent=new e.bkB}onIconClick(r){this.iconClickEvent.emit({type:r})}onChange(){const r=this.control.value;if(Array.isArray(r)&&r.length){const p=this.config.options.find(l=>l.value===r[0]);return p?p.name:""}{const p=this.config.options.find(l=>l.value===r);return p?p.name:""}}static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["shared-select"]],inputs:{config:"config",control:"control"},outputs:{iconClickEvent:"iconClickEvent"},decls:12,vars:16,consts:[[1,"shared-select",3,"appearance","color"],["matPrefix","","class","d-flex align-items-center mx-2 cursor-pointer",3,"config","click",4,"ngIf"],[3,"formControl","multiple"],[4,"ngIf"],[3,"border-bottom","value",4,"ngIf"],[3,"border-bottom","value",4,"ngFor","ngForOf"],["matSuffix","","class","d-flex align-items-center mx-2 cursor-pointer",3,"config","click",4,"ngIf"],[4,"ngFor","ngForOf"],["matPrefix","",1,"d-flex","align-items-center","mx-2","cursor-pointer",3,"config","click"],["class","example-additional-selection",4,"ngIf"],[1,"example-additional-selection"],[3,"value"],["matSuffix","",1,"d-flex","align-items-center","mx-2","cursor-pointer",3,"config","click"],[3,"control"]],template:function(p,l){1&p&&(e.j41(0,"mat-form-field",0),e.DNE(1,D,1,1,"shared-icon",1),e.j41(2,"mat-label"),e.EFF(3),e.k0s(),e.j41(4,"mat-select",2),e.DNE(5,b,3,2,"mat-select-trigger",3),e.DNE(6,$,2,1,"mat-select-trigger",3),e.DNE(7,T,2,4,"mat-option",4),e.DNE(8,I,2,4,"mat-option",5),e.k0s(),e.DNE(9,M,1,1,"shared-icon",6),e.DNE(10,F,2,1,"mat-error",7),e.nI1(11,"keyvalue"),e.k0s()),2&p&&(e.AVh("hide-extra",l.config.hideExtra),e.Y8G("appearance",l.config.appearance?l.config.appearance:"outline")("color",l.config.color?l.config.color:"primary"),e.R7$(1),e.Y8G("ngIf",l.config.prefixIcon),e.R7$(2),e.JRh(l.config.label),e.R7$(1),e.Y8G("formControl",l.control)("multiple",l.config.multiple),e.R7$(1),e.Y8G("ngIf",l.config.multiple),e.R7$(1),e.Y8G("ngIf",!l.config.multiple),e.R7$(1),e.Y8G("ngIf",void 0!==l.config.emptyOption),e.R7$(1),e.Y8G("ngForOf",l.config.options),e.R7$(1),e.Y8G("ngIf",l.config.suffixIcon),e.R7$(1),e.Y8G("ngForOf",e.bMT(11,14,l.control.errors)))},dependencies:[g.Sq,g.bT,C.BC,C.l_,d.rl,d.nJ,d.TL,d.JW,d.yw,t.VO,t.$2,a.wT,m.R,f.D,g.lG],styles:[".shared-select[_ngcontent-%COMP%]{width:100%}.hide-extra[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}"]})}return c})()},6834:(A,E,o)=>{function g(a,m="long",f){const D=a.getDate(),R=a.getFullYear(),b=a.toLocaleString("en-us",{month:m});return f?`${b} ${R}`:`${D} ${b} ${R}`}function d(a){return a?("string"==typeof a?new Date(a):a).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}):""}function t(a,m="short"){return"full"===m?["January","February","March","April","May","June","July","August","September","October","November","December"][a]:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a]}o.d(E,{KA:()=>t,lh:()=>d,pA:()=>g})},785:(A,E,o)=>{o.d(E,{v:()=>C});var e=o(9417);function C(d){return d instanceof e.gE?(d.markAllAsTouched(),Object.values(d.controls).forEach(t=>{t instanceof e.gE?Object.values(t.controls).forEach(a=>{a.markAsDirty()}):t.markAsDirty()})):(d.markAsTouched(),d.markAsDirty()),d.valid}}}]);