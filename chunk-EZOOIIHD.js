import{a as B}from"./chunk-KC6WF73M.js";import{a as N,b as T}from"./chunk-X6SDYXME.js";import"./chunk-JHOHYJWD.js";import{a as r}from"./chunk-TL6R7WHS.js";import{a}from"./chunk-US4DBW3U.js";import"./chunk-IXDNPNBC.js";import"./chunk-IA4DM2LR.js";import{a as F}from"./chunk-JU5LHE6N.js";import{a as P}from"./chunk-TRRKCROW.js";import{Y as D,fa as A,xa as M,ya as k}from"./chunk-XVDAFDV3.js";import{Cb as l,Da as x,Ib as g,L as d,Nb as y,Ob as E,Pb as b,Wb as C,Yb as S,a as p,fb as u,ia as o,m as h,ma as m,pc as w,qb as f,rc as v,xb as _}from"./chunk-PV357URW.js";var L=n=>({date:n,format:"MMMM yyyy"});function $(n,s){if(n&1&&b(0,"ks-basic-grid",1),n&2){let c=S();l("config",c.gridConfig)("refresh$",c.refresh$)}}var Q=(()=>{let s=class s{constructor(){this._dialog=o(A),this._destroyRef=o(x),this._navService=o(F),this._expensesService=o(B),this.refresh$=new h,this._isAdmin=r(a.ADMIN),this._canAdd=r(a.ADD_EXPENSE),this._canEdit=r(a.EDIT_EXPENSE),this._canDelete=r(a.DELETE_EXPENSE),this.dateSig=this._expensesService.dateSig}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:P.LAYOUT.children.EXPENSES.name,buttons:[{label:{text:"Change Month"},prefixIcon:{icon:"icon_calendar"},onClick:()=>{this._openSearchByDate()}},{label:{text:"Add Expense"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._canAdd,onClick:()=>{this._openExpensePopup()}}]}),this._initializeGrid(),this._expensesService.getExpenses()}ngAfterViewInit(){this._expensesService.filteredExpenses$.pipe(D(this._destroyRef)).subscribe(e=>{this.refresh$.next({data:e})})}changeDate(e){this._expensesService.changeDate(e)}_openSearchByDate(){let e={hideClearButton:!0,title:{text:"Change Month"},saveButton:{label:{text:"Search"},prefixIcon:{icon:"icon_search"},matType:"mat-stroked-button"},form:{value:{month:new Date().getMonth()+1,year:new Date().getFullYear()},fields:[{name:"month",label:{text:"Month"},type:"select",required:!0,options:T},{name:"year",label:{text:"Year"},type:"text",required:!0,onlyNumeric:!0,maxLength:4,minLength:4}]}};this._dialog.openFormPopup(e,"400px").afterClosed().pipe(d(1)).subscribe(t=>{t&&this._expensesService.changeDate(t)})}_initializeGrid(){this.gridConfig={data:f([]),defaultPagination:100,maxTableHeight:"calc(100dvh - 115px - 50px - 50px - 50px - 80px)",noDataMessage:{text:"No Expenses Found"},features:{showSearch:!0},columns:[{field:"name",title:"Expense",type:"string",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"}},{field:"amount",title:"Amount",type:"number",extraStyles:{"min-width":"100px","max-width":"100px",width:"100px"}},{field:"notes",title:"Notes",type:"string",extraStyles:{"max-width":"300px","min-width":"150px"}},{field:"date",title:"Date",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"110px","max-width":"110px",width:"110px"}},{field:"createdBy",title:"Created By",type:"string",extraStyles:{"min-width":"120px","max-width":"120px",width:"120px"},hide:!this._isAdmin},{field:"createdAt",title:"Created At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"170px","max-width":"170px",width:"170px"},hide:!this._isAdmin}],actionsColumn:{enabled:this._canEdit||this._canDelete,maxButtons:window.innerWidth<700?1:void 0,width:window.innerWidth<700?void 0:"110px",maxWidth:window.innerWidth<700?void 0:"110px",minWidth:window.innerWidth<700?void 0:"110px",buttons:[]}},this._canEdit&&this.gridConfig.actionsColumn?.buttons?.push({prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:e=>this._openExpensePopup(e),matType:"mat-icon-button",isVisibleFn:()=>this._canEdit}),this._canDelete&&this.gridConfig.actionsColumn?.buttons?.push({prefixIcon:{icon:"icon_delete"},color:"warn",label:{text:"Delete"},onClickFn:e=>this._deleteExpense(e),matType:"mat-icon-button",isVisibleFn:()=>this._canDelete})}_openExpensePopup(e){let t={title:{text:e?"Edit Expense":"Add Expense"},form:{value:e||{date:N()},fields:[{name:"name",label:{text:"Expense"},type:"autocomplete",required:!0,maxLength:30,stream:this._expensesService.expensesLov$,transformer:{nameKey:"name",valueKey:"value"}},{name:"amount",type:"number",label:{text:"Amount in $"},required:!0,range:{max:1e5}},{name:"date",type:"date",label:{text:"Date"},required:!0},{name:"notes",type:"text",label:{text:"Notes"},maxLength:100}]},beforeCloseObservable:i=>e?this._expensesService.updateExpense(p(p({},e),i)):this._expensesService.addExpense(i),getAfterSuccessResponse:i=>{i.data&&this._expensesService._update(i.data,e?"edit":"add")}};this._dialog.openFormPopup(t,"500px")}_deleteExpense(e){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this expense?"}}).afterClosed().pipe(d(1)).subscribe(t=>{t&&e?._id&&this._expensesService.deleteExpense(e)})}};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=m({type:s,selectors:[["ks-solutions-expenses"]],standalone:!0,features:[w],decls:2,vars:4,consts:[[3,"btnClicked","config"],[3,"config","refresh$"]],template:function(t,i){t&1&&(y(0,"ks-base-changer",0),C("btnClicked",function(I){return i.changeDate(I)}),E(),_(1,$,1,2,"ks-basic-grid",1)),t&2&&(l("config",v(2,L,i.dateSig)),u(),g(i.gridConfig?1:-1))},dependencies:[M,k],changeDetection:0});let n=s;return n})();export{Q as ExpensesComponent};
