"use strict";(self.webpackChunkpos=self.webpackChunkpos||[]).push([[844],{8844:(w,f,s)=>{s.r(f),s.d(f,{WholesaleCustomerModule:()=>k});var g=s(6814),D=s(3403),h=s(7700),m=s(8223),t=s(5879),r=s(2025),a=s(7757),c=s(9866);const l=function(){return{"box-shadow":"var(--opened-invoice-shadow)"}},p=function(n){return{extraClass:"w-100 h-100 cs-bg-blue p-3",extraStyles:n}},v=function(){return{icon:"contact_phone",ripple:!0}},T=function(){return{icon:"calendar_today",ripple:!0}},M=function(){return{icon:"monetization_on",ripple:!0}};function R(n,y){if(1&n&&(t.TgZ(0,"div",5)(1,"shared-card",6)(2,"div",7),t._UZ(3,"shared-icon",8),t.TgZ(4,"span",9),t._uU(5),t.qZA()(),t.TgZ(6,"div",10),t._UZ(7,"shared-icon",8),t.TgZ(8,"span",9),t._uU(9),t.qZA()(),t.TgZ(10,"div",7),t._UZ(11,"shared-icon",8),t.TgZ(12,"span",9),t._uU(13),t.qZA()()()()),2&n){const e=y.$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("config",t.VKq(8,p,t.DdM(7,l))),t.xp6(2),t.Q6J("config",t.DdM(10,v)),t.xp6(2),t.Oqu(e.contact),t.xp6(2),t.Q6J("config",t.DdM(11,T)),t.xp6(2),t.Oqu(o.changeDate(e.bookedDate)),t.xp6(2),t.Q6J("config",t.DdM(12,M)),t.xp6(2),t.Oqu(e.price)}}function W(n,y){if(1&n&&(t.TgZ(0,"div",2)(1,"div",3),t.YNc(2,R,14,13,"div",4),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngForOf",e.data.bookings)}}const S=function(){return{title:"Customer's Reservations"}};let N=(()=>{class n{constructor(e,o){this.data=e,this._dialogRef=o}handleDialogActions(e){(!e||"ok"===e||"cancel"===e)&&this.closeDialog()}changeDate(e){return(0,m.M)(e)}closeDialog(){this._dialogRef.close()}static#t=this.\u0275fac=function(o){return new(o||n)(t.Y36(h.WI),t.Y36(h.so))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-customer-popup"]],decls:2,vars:3,consts:[[3,"config","btnClicked"],["class","container py-2 cd-max",4,"ngIf"],[1,"container","py-2","cd-max"],[1,"row","justify-content-center","my-auto"],["class","cs-card",4,"ngFor","ngForOf"],[1,"cs-card"],[1,"active",3,"config"],[1,"d-flex","align-items-center","gap-2"],[1,"cursor-pointer",3,"config"],[1,"text-break"],[1,"d-flex","align-items-center","gap-2","my-1"]],template:function(o,i){1&o&&(t.TgZ(0,"shared-confirm-body",0),t.NdJ("btnClicked",function(d){return i.handleDialogActions(d)}),t.YNc(1,W,3,1,"div",1),t.qZA()),2&o&&(t.Q6J("config",t.DdM(2,S)),t.xp6(1),t.Q6J("ngIf",i.data&&i.data.bookings))},dependencies:[g.sg,g.O5,r.o,a.A,c.F],styles:[".cd-max[_ngcontent-%COMP%]{max-height:calc(90vh - 150px);overflow-y:scroll}.cs-card[_ngcontent-%COMP%]{width:250px;margin-bottom:20px;font-size:16px;font-weight:700;cursor:pointer;position:relative}.active[_ngcontent-%COMP%]{background-color:var(--primary-color)}"]})}return n})();var C=s(9773),$=s(8180),O=s(9017);const _=function(){return{icon:"info",ripple:!0}};let F=(()=>{class n{constructor(e){this._customerService=e}agInit(e){this.cellValue=this.getValueToDisplay(e)}refresh(e){return this.cellValue=this.getValueToDisplay(e),!0}onInfo(){this._customerService.changes$.next({action:"view-details",customer:this.rowValue})}getValueToDisplay(e){return this.rowValue=e.data,e.valueFormatted?e.valueFormatted:e.value}static#t=this.\u0275fac=function(o){return new(o||n)(t.Y36(m.s))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["total-value-component"]],decls:2,vars:2,consts:[[1,"h-100","w-100","d-flex","align-items-center","justify-content-center"],[1,"cursor-pointer",3,"config","click"]],template:function(o,i){1&o&&(t.TgZ(0,"div",0)(1,"shared-icon",1),t.NdJ("click",function(){return i.onInfo()}),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("config",t.DdM(1,_)))},dependencies:[r.o],styles:["button[_ngcontent-%COMP%]{border:none;background-color:inherit}"]})}return n})();var J=s(6223),Z=s(5994),E=s(6775),P=s(7022),x=s(1486),I=s(1961),b=s(5083),z=s(4246);const L=function(){return{icon:"search",color:"var(--primary-color)"}},Q=function(n){return{label:"Search",prefixIcon:n}};var A=function(n){return n.downloadExcel="Download Excel",n}(A||{});const U=[{path:"",component:(()=>{class n extends E.H{constructor(e,o,i){super(o),this._dialog=e,this._navService=o,this._LocalCustomersService=i,this.buttons=[],this.isAdmin=(0,O.q)(Z.l.admin),this.innerWidth=window.innerWidth,this.searchControl=new J.NI(""),this.columnDefs=this.getCols(),this.defaultColDef={initialWidth:100,sortable:!0,resizable:!0,filter:!0,flex:1,minWidth:100}}ngOnInit(){this._LocalCustomersService.getAllCustomersNames(),this.isAdmin&&this.buttons.push({label:A.downloadExcel,prefixIcon:{icon:"library_books"}}),this.Navbar_Update({show:!0,back:!1,title:this.NAV_NAMES.CUSTOMERS_MANAGEMENT.children.WHOLESALE.name,buttons:this.buttons}),this.NavButtons$.pipe((0,C.R)(this.__unsubscribe$)).subscribe(e=>{e===A.downloadExcel&&this.downloadExcel()}),this.searchControl.valueChanges.pipe((0,C.R)(this.__unsubscribe$)).subscribe(e=>{this.onFilterTextBoxChanged(e)}),this._LocalCustomersService.changes$.pipe((0,C.R)(this.__unsubscribe$)).subscribe(e=>{"view-details"===e.action&&this.openCustomerReservations(e.customer)})}ngOnDestroy(){super.ngOnDestroy(),this._LocalCustomersService.changes$.next({})}onGridReady(e){this.gridApi=e.api,this._LocalCustomersService.customers$.pipe((0,C.R)(this.__unsubscribe$)).subscribe(o=>this.rowData=o)}onFilterTextBoxChanged(e){this.gridApi.setQuickFilter(e)}openCustomerReservations(e){this._dialog.open(N,{width:"95vw",maxWidth:"600px",maxHeight:"95vh",disableClose:!0,restoreFocus:!1,data:e})}downloadExcel(){this._LocalCustomersService.customers$.pipe((0,$.q)(1)).subscribe(e=>{!function B(n){if(!n&&!Array.isArray(n))return;const y=(0,P.fK)(new Date),e=[];n.forEach(u=>{u.bookings.forEach(d=>{e.push({"Customer Name":u.name,"Nb Of Reservations":u.count,"Contact Info":d.contact,"Reservation Date":(0,m.M)(d.bookedDate),"Reservation Price":d.price})})});const o=x.P6.json_to_sheet(e);o["!cols"]=[{width:50},{width:20},{width:30},{width:20},{width:20}];const i=x.P6.book_new();x.P6.book_append_sheet(i,o,"Details"),(0,x.NC)(i,`Customers_At_${y.replaceAll(" ","_")}.xlsx`)}(e)})}getCols(){return[{headerName:"Name",field:"name",minWidth:150},{headerName:"Reservations",field:"count",width:150,minWidth:150,maxWidth:150},{headerName:"",cellRenderer:F,width:60,minWidth:60,maxWidth:60,sortable:!1,filter:!1,resizable:!1,pinned:"right"}]}onWindowResize(e){this.innerWidth=window.innerWidth}static#t=this.\u0275fac=function(o){return new(o||n)(t.Y36(h.uw),t.Y36(I.t),t.Y36(m.s))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-wholesale-customer"]],hostBindings:function(o,i){1&o&&t.NdJ("resize",function(){return i.onWindowResize()},!1,t.Jf7)},features:[t.qOj],decls:3,vars:15,consts:[[2,"max-width","300px"],[3,"config","control"],[2,"width","100%","height","calc(100vh - 255px)","min-height","400px",3,"rowHeight","columnDefs","defaultColDef","rowData","pagination","paginationAutoPageSize","gridReady"]],template:function(o,i){1&o&&(t.TgZ(0,"div",0),t._UZ(1,"shared-input",1),t.qZA(),t.TgZ(2,"ag-grid-angular",2),t.NdJ("gridReady",function(d){return i.onGridReady(d)}),t.qZA()),2&o&&(t.xp6(1),t.Q6J("config",t.VKq(13,Q,t.DdM(12,L)))("control",i.searchControl),t.xp6(1),t.ekj("ag-theme-alpine","light"===i.$theme)("ag-theme-alpine-dark","dark"===i.$theme),t.Q6J("rowHeight",35)("columnDefs",i.columnDefs)("defaultColDef",i.defaultColDef)("rowData",i.rowData)("pagination",i.innerWidth>700)("paginationAutoPageSize",!0))},dependencies:[b.N8,z.a]})}return n})()}];let Y=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[D.Bz.forChild(U),D.Bz]})}return n})();var V=s(9255),H=s(9781),j=s(7858);let k=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[g.ez,b.sF,Y,V.B,h.Is,H.n,j.j]})}return n})()},7022:(w,f,s)=>{function h(r,a="long",c){const l=r.getDate(),p=r.getFullYear(),v=r.toLocaleString("en-us",{month:a});return c?`${v} ${p}`:`${l} ${v} ${p}`}function m(r){return r?("string"==typeof r?new Date(r):r).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}):""}function t(r,a="short"){return"full"===a?["January","February","March","April","May","June","July","August","September","October","November","December"][r]:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][r]}s.d(f,{TG:()=>m,fK:()=>h,p_:()=>t})}}]);